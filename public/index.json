[
{
	"uri": "/3-deploy-lambda-function/3-1-create-dynamodb-table/",
	"title": "Create DynamoDB table",
	"tags": [],
	"description": "",
	"content": " Open template.yaml file in fcj-book-store folder Add the following script at the end of the file to create a simple table in DynamoDB: SimpleTable: Type: AWS:Serverless::SimpleTable Properties: TableName: SimpleTable PrimaryKey: Name: id Type: String The script defines a SimpleTable table in DynamoDB with the Partition key is id Run the following command to deploy SAM sam build sam deploy Open DynamoDB console Select Tables on the left menu. You can see SimpleTable table created But our table needs more config. So delete the above script and replace it with the following: BooksTable: Type: AWS::DynamoDB::Table Properties: TableName: Books BillingMode: PAY_PER_REQUEST AttributeDefinitions: - AttributeName: id AttributeType: S - AttributeName: rv_id AttributeType: N - AttributeName: name AttributeType: S KeySchema: - AttributeName: id KeyType: HASH - AttributeName: rv_id KeyType: RANGE LocalSecondaryIndexes: - IndexName: name-index KeySchema: - AttributeName: id KeyType: HASH - AttributeName: name KeyType: RANGE Projection: ProjectionType: ALL The above script creates the Books table in DynamoDB with the partition key of id, the sort key of rv_id and a Local Scondary Index. Run the following command to deploy SAM sam build sam deploy Back to DynamoDB console. The Books table have been created and SimpleTable table deleted Select Books table. Check informations of this table Click Indexes tab So you have created the Books table with the Local secondary index of name-index\nTo add data to the table, you can download the below file. Then, open file and replace all AWS-REGION with the region that create S3 bucket - book-image-resize-store, such as: ap-southeast-1 Data dynamoDB.json (4 ko) Run the following command at the directory where you save the dynamoDB.json file aws dynamodb batch-write-item --request-items file://dynamoDB.json "
},
{
	"uri": "/4-config-api-gw/4-1-get-api/",
	"title": "Create GET API",
	"tags": [],
	"description": "",
	"content": " Open template.yaml in fcj-book-store folder Add the following script at the end of the file creating a REST API and GET method BookApi: Type: AWS::Serverless::Api Name: fcj-serverless-api Properties: StageName: staging Cors: \u0026#34;\u0026#39;*\u0026#39;\u0026#34; # enable CORS for API DefinitionBody: openapi: 3.0.1 info: description: \u0026#34;This is the APIs for book store web app\u0026#34; version: \u0026#34;1.0.0\u0026#34; title: \u0026#34;API Gateway REST API to Lambda\u0026#34; paths: /books: get: responses: \u0026#34;200\u0026#34;: description: 200 response headers: Access-Control-Allow-Origin: type: string x-amazon-apigateway-integration: uri: Fn::Sub: \u0026#34;arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${BooksList.Arn}/invocations\u0026#34; responses: default: statusCode: 200 responseParameters: method.response.header.Access-Control-Allow-Origin: \u0026#34;\u0026#39;*\u0026#39;\u0026#34; passthroughBehavior: when_no_match httpMethod: POST #always POST type: aws_proxy Add the following script at the end of the BooksList function Events: ListBook: Type: Api Properties: Path: /books/ Method: get RestApiId: Ref: BookApi Run the following command to deploy SAM sam build sam deploy Enter \u0026ldquo;y\u0026rdquo; if asked \u0026ldquo;BooksList may not have authorization defined, Is this okay? [y/N]: \u0026quot;\nOpen Lambda console, click books_list function Click API Gateway Show API Gateway being interacted with function Click this API Gateway Display resources and GET method Click Stages on the left menu Click staging Click GET Record InvokeURL of GET method "
},
{
	"uri": "/3-deploy-lambda-function/3-2-deploy-lambda-function/3-2-1-list-data-function/",
	"title": "Listing Lambda function",
	"tags": [],
	"description": "",
	"content": "We will create a Lambda function that reads all the data in the DynamoDB table:\nOpen template.yaml file in fcj-book-store folder Add the following script at the end of the file BooksList: Type: AWS::Serverless::Function Properties: CodeUri: fcj-book-store/books_list Handler: books_list.lambda_handler Runtime: python3.9 FunctionName: books_list Architectures: - x86_64 Policies: - Statement: - Sid: ReadDynamoDB Effect: Allow Action: - dynamodb:Scan - dynamodb:Query Resource: - !Sub arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/Books The directory structure is as follows: fcj-book-store ├── fcj-book-store │ ├── books_list │ └── books_list.py └── template.yaml Create fcj-book-store/books_list folder in fcj-book-store folder Create books_list.py file and copy the below code block to it import json import boto3 from decimal import * from boto3.dynamodb.types import TypeDeserializer client = boto3.client(\u0026#39;dynamodb\u0026#39;) serializer = TypeDeserializer() class DecimalEncoder(json.JSONEncoder): def default(self, obj): if isinstance(obj, Decimal): return str(obj) return json.JSONEncoder.default(self, obj) def deserialize(data): if isinstance(data, list): return [deserialize(v) for v in data] if isinstance(data, dict): try: return serializer.deserialize(data) except TypeError: return {k: deserialize(v) for k, v in data.items()} else: return data def lambda_handler(event, context): data_books = client.scan( TableName=\u0026#39;Books\u0026#39;, IndexName=\u0026#39;name-index\u0026#39; ) format_data_books = deserialize(data_books[\u0026#34;Items\u0026#34;]) for book in format_data_books: data_comment = client.query( TableName=\u0026#34;Books\u0026#34;, KeyConditionExpression=\u0026#34;id = :id AND rv_id \u0026gt; :rv_id\u0026#34;, ExpressionAttributeValues={ \u0026#34;:id\u0026#34;: {\u0026#34;S\u0026#34;: book[\u0026#39;id\u0026#39;]}, \u0026#34;:rv_id\u0026#34;: {\u0026#34;N\u0026#34;: \u0026#34;0\u0026#34;} } ) format_data_comment = deserialize(data_comment[\u0026#39;Items\u0026#39;]) print(data_comment[\u0026#39;Items\u0026#39;]) book[\u0026#34;comments\u0026#34;] = format_data_comment print (format_data_books) return { \u0026#34;statusCode\u0026#34;: 200, \u0026#34;headers\u0026#34;: { \u0026#34;Content-Type\u0026#34;: \u0026#34;application/json\u0026#34;, \u0026#34;Access-Control-Allow-Origin\u0026#34;: \u0026#34;*\u0026#34;, \u0026#34;Access-Control-Allow-Methods\u0026#34;: \u0026#34;GET,PUT,POST,DELETE, OPTIONS\u0026#34;, \u0026#34;Access-Control-Allow-Headers\u0026#34;: \u0026#34;Access-Control-Allow-Headers, Origin,Accept, X-Requested-With, Content-Type, Access-Control-Request-Method,X-Access-Token,XKey,Authorization\u0026#34; }, \u0026#34;body\u0026#34;: json.dumps(format_data_books, cls=DecimalEncoder) } Run the following command to deploy SAM sam build sam deploy Open AWS Lambda console Click books_list function created Click Configuration tab Select Permissions on the left menu Click on the role that the function is executing Expand the policy, see the permissions granted to the function "
},
{
	"uri": "/1-preparation/",
	"title": "Preparation",
	"tags": [],
	"description": "",
	"content": "To start building SAM-based applications, we must first install the SAM CLI, install the AWS credentials, and initialize a simple SAM application.\nInstall SAM CLI for OS: MacOS brew tap aws/tap brew install aws-sam-cli sam --version Linux pip install aws-sam-cli sam --version Windows Downloads AWS SAM CLI 64-bit Install file and check version of SAM sam --version You can refer to: https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html\nIf you have already installed AWS credentials from previous posts, you can skip this step. Open IAM console Click User on the left menu. Click Create user button Enter user name, such as: AdminSAMUser Select Password - AWS Mannagemant Console access of Select AWS credentail type pattern Select Custom password, then enter your password Uncheck the Require password reset Click Next: Permissions Select Attach existing policies directly Select AdministratorAccess policy to the user has full access to the services Click Next: Tags Click Next: Review Review configuration, and click Create user Click on the newly created user. Click Security credentials tab Click Create access key Click Download .csv file Run the command using the terminal on your device aws configure Enter the information corresponding to the columns in the credential file you downloaded AWS Access key ID: Enter access key ID AWS Secret access key: Enter secret access key Default region name: Enter region closest to you Default output format: Can be overlooked Then, create a sample SAM project Run the below commands at the directory where you want to deploy the application #Step 1 - Download a sample application sam init Then select the options: Which template source would you like to use? 1 - AWS Quick Start Templates 2 - Custom Template Location Choice: 1 Choose an AWS Quick Start application template 1 - Hello World Example 2 - Multi-step workflow 3 - Serverless API 4 - Scheduled task 5 - Standalone function 6 - Data processing 7 - Infrastructure event management 8 - Machine Learning Template: 1 Use the most popular runtime and package type? (Python and zip) [y/N]: y Would you like to enable X-Ray tracing on the function(s) in your application? [y/N]: n Project name [sam-app]: fcj-book-store You have created a sample SAM project. Next , we will edit that project according to our application architecture.\n"
},
{
	"uri": "/",
	"title": "Serverless - Deploying applications with SAM",
	"tags": [],
	"description": "",
	"content": "Serverless - Deploying applications with SAM Overview In the first two articles of this series, we know how to build a simple serverless web application using the AWS console. To build the serverless application faster, AWS provides users with the AWS Serverless Application Model (SAM) service, which is an open-source framework for building a serverless applications. It provides shorthand syntax to express functions, APIs, databases, and event source mappings. You define the application you want with just a few lines per resource and model it using YAML. During deployment, SAM transforms and expands the SAM syntax into AWS CloudFormation syntax. Then, CloudFormation provides the resources to the user.\nIn this workshop 3, we will rebuild the web application in workshop 2 with AWS SAM.\nThe architecture of the application we will build:\nContent Preparation Front-end deployment Deploy Lambda function Config API Gateway Test API by Postman Test API with front-end Cleanup "
},
{
	"uri": "/4-config-api-gw/4-2-post-api/",
	"title": "Create POST API",
	"tags": [],
	"description": "",
	"content": " Open template.yaml file in fcj-book-store folder Add the following script at the end of the file that create the POST method post: responses: \u0026#34;200\u0026#34;: description: 200 response headers: Access-Control-Allow-Origin: type: string x-amazon-apigateway-integration: uri: Fn::Sub: \u0026#34;arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${BookCreate.Arn}/invocations\u0026#34; responses: default: statusCode: 200 responseParameters: method.response.header.Access-Control-Allow-Origin: \u0026#34;\u0026#39;*\u0026#39;\u0026#34; passthroughBehavior: when_no_match httpMethod: POST #always POST type: aws_proxy Add the following script at the end of the BookCreate function Events: CreateBook: Type: Api Properties: Path: /books/ Method: post RestApiId: Ref: BookApi Run the following command to deploy SAM sam build sam deploy --guided Enter \u0026ldquo;y\u0026rdquo; if asked \u0026ldquo;BookCreate may not have authorization defined, Is this okay? [y/N]:\u0026rdquo;\nOpen book_create function console Click API Gateway Show API Gateway being interacted with this function Click this API Gateway Display the resources and POST method Click Stages on the left menu Click staging Click POST Record InvokeURL of POST method "
},
{
	"uri": "/2-front-end-deployment/",
	"title": "Deploy front-end",
	"tags": [],
	"description": "",
	"content": "In this step, we will create an S3 bucket with Static web hosting enabled and publicly accessible based on SAM:\nOpen template.yaml file in fcj-book-store folder that we created in part 1. Delete unnecessary part: Copy the following script into that file: FcjBookStore: Type: AWS::S3::Bucket Properties: BucketName: fcj-book-store PublicAccessBlockConfiguration: BlockPublicAcls: \u0026#39;false\u0026#39; BlockPublicPolicy: \u0026#39;false\u0026#39; WebsiteConfiguration: IndexDocument: index.html FcjBookStorePolicy: Type: AWS::S3::BucketPolicy Properties: Bucket: !Ref FcjBookStore PolicyDocument: Version: 2012-10-17 Statement: - Action: - \u0026#39;s3:GetObject\u0026#39; Effect: Allow Principal: \u0026#39;*\u0026#39; Resource: !Join - \u0026#39;\u0026#39; - - \u0026#39;arn:aws:s3:::\u0026#39; - !Ref FcjBookStore - /* The above script defines an S3 bucket is fcj-book-store with FcjBookStorePolicy policy - allow public access\nRun the below command to build at the directory of the SAM project: fcj-book-store sam build Run the following command to check the validation of the SAM template sam validate Run the following command to deploy SAM sam deploy --guided Enter stack name: fcj-book-store Enter the deployemnt region, such as: ap-southeast-1- should be the same as the default region Then enter other information as shown below Wait a while to create the CloudFormation stack changeset Enter \u0026ldquo;y\u0026rdquo; when Deploy this changeset? display Open Amazon S3 console Check if the bucket has been created or not. Click fcj-book-store bucket Click Properties tab Scroll down, check state of Static website hosting Record the endpoint of the website Click Permissions tab See the policy has been added Open CloudFormation console Two stacks have been created Click fcj-book-store stack Click Resource tab, see the resources that CloudFormation has initialized Click to other stack: Download fcj-serverless-frontend code to your device Open a terminal on your computer at the directory where you want to save the source code Copy the below command git clone https://github.com/AWS-First-Cloud-Journey/FCJ-Serverless-Workshop.git cd FCJ-Serverless-Workshop yarn build We have finished building the front-end. Next, execute the following command to upload the build folder to S3 aws s3 cp build s3://fcj-book-store --recursive Result after uploading:\n"
},
{
	"uri": "/3-deploy-lambda-function/3-2-deploy-lambda-function/",
	"title": "Deploy Lambda function",
	"tags": [],
	"description": "",
	"content": "In this step, we will create Lambda functions to read, write, and delete data in DynamoDB. Then grant the necessary permissions to those functions.\nContent Update writing Lambda function Create listing Lambda function Create deleting Lambda function Create Lambda function to edit image "
},
{
	"uri": "/3-deploy-lambda-function/3-2-deploy-lambda-function/3-2-2-write-data-function/",
	"title": "Writing Lambda function",
	"tags": [],
	"description": "",
	"content": "In this step we create a new Lambda function to write data to DynamoDB on SAM\nOpen template.yaml file in fcj-book-store folder Add the following script at the end of the file to create a Lambda function that writes data to DynamoDB BookCreate: Type: AWS::Serverless::Function Properties: CodeUri: fcj-book-store/book_create Handler: book_create.lambda_handler Runtime: python3.9 FunctionName: book_create Architectures: - x86_64 Policies: - Statement: - Sid: BookCreateItem Effect: Allow Action: - dynamodb:PutItem - s3:PutObject Resource: - !Sub arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/Books - arn:aws:s3:::book-image-store/* Add the following script at the end of the file to create an S3 bucket that stores uploaded image files BookImageStore: Type: AWS::S3::Bucket Properties: BucketName: book-image-store If you create S3 bucket name is different from the one in the lab, please update Policies | Resources of book_create function with that name\nThe directory structure is as follows: fcj-book-store ├── fcj-book-store │ ├── books_list │ │ └── books_list.py │ ├── book_create │ └── book_create.py └── template.yaml Create book_create folder in fcj-book-store/fcj-book-store/ folder Create book_create.py file and copy the below code block to it import boto3 import json import base64 import io import cgi import os s3 = boto3.client(\u0026#39;s3\u0026#39;) client = boto3.resource(\u0026#39;dynamodb\u0026#39;) runtime_region = os.environ[\u0026#39;AWS_REGION\u0026#39;] def get_data_from_request_body(content_type, body): fp = io.BytesIO(base64.b64decode(body)) # decode environ = {\u0026#34;REQUEST_METHOD\u0026#34;: \u0026#34;POST\u0026#34;} headers = { \u0026#34;content-type\u0026#34;: content_type, \u0026#34;content-length\u0026#34;: len(body), } fs = cgi.FieldStorage(fp=fp, environ=environ, headers=headers) return [fs, None] def lambda_handler(event, context): content_type = event[\u0026#39;headers\u0026#39;].get(\u0026#39;Content-Type\u0026#39;, \u0026#39;\u0026#39;) or event[\u0026#39;headers\u0026#39;].get(\u0026#39;content-type\u0026#39;, \u0026#39;\u0026#39;) if content_type == \u0026#39;application/json\u0026#39;: book_item = json.loads(event[\u0026#34;body\u0026#34;]) else: book_data, book_data_error = get_data_from_request_body( content_type=content_type, body=event[\u0026#34;body\u0026#34;] ) name = book_data[\u0026#39;image\u0026#39;].filename image = book_data[\u0026#39;image\u0026#39;].value s3.put_object(Bucket=\u0026#39;book-image-store\u0026#39;, Key=name, Body=image) image_path = \u0026#34;https://{}.s3.{}.amazonaws.com/{}\u0026#34;.format(\u0026#34;book-image-resize-store\u0026#34;, runtime_region, name) book_item = { \u0026#34;id\u0026#34;: book_data[\u0026#39;id\u0026#39;].value, \u0026#34;rv_id\u0026#34;: 0, \u0026#34;name\u0026#34;: book_data[\u0026#39;name\u0026#39;].value, \u0026#34;author\u0026#34;: book_data[\u0026#39;author\u0026#39;].value, \u0026#34;price\u0026#34; : book_data[\u0026#39;price\u0026#39;].value, \u0026#34;category\u0026#34;: book_data[\u0026#39;category\u0026#39;].value, \u0026#34;description\u0026#34;: book_data[\u0026#39;description\u0026#39;].value, \u0026#34;image\u0026#34;: image_path } table = client.Table(\u0026#39;Books\u0026#39;) table.put_item(Item = book_item) response = { \u0026#39;statusCode\u0026#39;: 200, \u0026#39;body\u0026#39;: \u0026#39;successfully created item!\u0026#39;, \u0026#39;headers\u0026#39;: { \u0026#39;Content-Type\u0026#39;: \u0026#39;application/json\u0026#39;, \u0026#34;Access-Control-Allow-Headers\u0026#34;: \u0026#34;Access-Control-Allow-Headers, Origin, Accept, X-Requested-With, Content-Type, Access-Control-Request-Method,X-Access-Token, XKey, Authorization\u0026#34;, \u0026#34;Access-Control-Allow-Origin\u0026#34;: \u0026#34;*\u0026#34;, \u0026#34;Access-Control-Allow-Methods\u0026#34;: \u0026#34;GET,PUT,POST,DELETE,OPTIONS\u0026#34; }, } return response Run the following command to deploy SAM sam build sam deploy Back to AWS Lambda console Click book_create function created Click Configuration tab Select Permissions on the left menu Click on the role that the function is executing Expand the policy, see the permissions granted to the function Open Amazon S3 console, the book-image-store bucket has been created "
},
{
	"uri": "/4-config-api-gw/4-3-delete-api/",
	"title": "Create DELETE API",
	"tags": [],
	"description": "",
	"content": " Open template.yaml file in fcj-book-store folder Add the following script at the end of the file that create the DELETE method /books/{id}: delete: responses: \u0026#34;200\u0026#34;: description: 200 response headers: Access-Control-Allow-Origin: type: string x-amazon-apigateway-integration: uri: Fn::Sub: \u0026#34;arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${BookDelete.Arn}/invocations\u0026#34; responses: default: statusCode: 200 responseParameters: method.response.header.Access-Control-Allow-Origin: \u0026#34;\u0026#39;*\u0026#39;\u0026#34; passthroughBehavior: when_no_match httpMethod: POST #always POST type: aws_proxy Add the following script at the end of the BookDelete function Events: DeleteBook: Type: Api Properties: Path: /books/{id} Method: delete RestApiId: Ref: BookApi Run the following command to deploy SAM sam build sam deploy --guided Enter \u0026ldquo;y\u0026rdquo; if asked \u0026ldquo;BookDelete may not have authorization defined, Is this okay? [y/N]: \u0026quot;\nOpen book_delete function console Click API Gateway Show API Gateway being interacted with this function Click this API Gateway Display the resources and DELETE method Click Stages on the left menu Click staging Click DELTE Record the InvokeURL of DELETE method Add the following script at the end of the template.yaml file to API can support Binary Media Types files BinaryMediaTypes: - multipart~1form-data Run the following command to deploy SAM sam build sam deploy --guided Back to API console Select Settings on the left menu Scroll down, check if multipart/form-data has been added under Binary Meida Types "
},
{
	"uri": "/3-deploy-lambda-function/3-2-deploy-lambda-function/3-2-3-delete-data-function/",
	"title": "Deleting Lambda function",
	"tags": [],
	"description": "",
	"content": "We will create a Lambda function that deletes all items with the specified partition key and sort key in the DynamoDB table. And delete the image file in the S3 bucket:\nOpen template.yaml file in fcj-book-store folder Add the following script at the end of the file to create a Lambda function that deletes data of DynamoDB table BookDelete: Type: AWS::Serverless::Function Properties: CodeUri: fcj-book-store/book_delete Handler: book_delete.lambda_handler Runtime: python3.9 FunctionName: book_delete Architectures: - x86_64 Policies: - Statement: - Sid: VisualEditor0 Effect: Allow Action: - dynamodb:DeleteItem - dynamodb:GetItem - dynamodb:Query - s3:DeleteObject Resource: - !Sub arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/Books - arn:aws:s3:::book-image-resize-store/* Add the following script at the end of the file to create an S3 bucket that saves the image after resizing with CORS rule and policy settings BookImageResizeStore: Type: AWS::S3::Bucket Properties: AccessControl: PublicRead BucketName: book-image-resize-store CorsConfiguration: CorsRules: - AllowedHeaders: - \u0026#39;*\u0026#39; AllowedMethods: - GET - PUT - POST - DELETE AllowedOrigins: - \u0026#39;*\u0026#39; BookImageResizeStorePolicy: Type: AWS::S3::BucketPolicy Properties: Bucket: !Ref BookImageResizeStore PolicyDocument: Version: 2012-10-17 Statement: - Action: - \u0026#39;s3:GetObject\u0026#39; Effect: Allow Principal: \u0026#39;*\u0026#39; Resource: !Join - \u0026#39;\u0026#39; - - \u0026#39;arn:aws:s3:::\u0026#39; - !Ref BookImageResizeStore - /* If you create S3 bucket names that are different from the ones in the lab, please check Policies | Resources of services and update.\nThe directory structure is as follows: fcj-book-store ├── fcj-book-store │ ├── books_list │ │ └── books_list.py │ ├── book_create │ │ └── book_create.py │ └── book_delete │ └── book_delete.py └── template.yaml Create book_delete folder in fcj-book-store/fcj-book-store/ folder Create book_delete.py file and copy the below code block to it import boto3 import json s3 = boto3.client(\u0026#39;s3\u0026#39;) client = boto3.resource(\u0026#39;dynamodb\u0026#39;) def get_image_name(image_path): str_image = image_path.split(\u0026#34;/\u0026#34;) for image_path_item in str_image: image_name = image_path_item return image_name; def lambda_handler(event, context): error = None status = 200 delete_id = event[\u0026#39;pathParameters\u0026#39;] delete_id[\u0026#39;rv_id\u0026#39;] = 0 table = client.Table(\u0026#34;Books\u0026#34;) image_path = \u0026#34;\u0026#34; try: data = table.get_item(Key = delete_id) image_path = data[\u0026#39;Item\u0026#39;][\u0026#39;image\u0026#39;] image_name = get_image_name(image_path) except Exception as e: error = e try: response = table.query( ProjectionExpression=\u0026#34;rv_id\u0026#34;, KeyConditionExpression=\u0026#34;id = :id\u0026#34;, ExpressionAttributeValues={\u0026#34;:id\u0026#34;: delete_id[\u0026#39;id\u0026#39;]}) for item in response[\u0026#39;Items\u0026#39;]: delete_id[\u0026#39;rv_id\u0026#39;] = item[\u0026#39;rv_id\u0026#39;] print(delete_id) table.delete_item(Key = delete_id) print(image_name) s3.delete_object(Bucket=\u0026#39;book-image-resize-store\u0026#39;, Key=image_name) except Exception as e: error = e if error is None: message = \u0026#39;successfully deleted item!\u0026#39; else: message = \u0026#39;delete item fail\u0026#39; status = 400 return { \u0026#39;statusCode\u0026#39;: status, \u0026#39;body\u0026#39;: message, \u0026#39;headers\u0026#39;: { \u0026#39;Content-Type\u0026#39;: \u0026#39;application/json\u0026#39;, \u0026#39;Access-Control-Allow-Origin\u0026#39;: \u0026#39;*\u0026#39; }, } Run the following command to deploy SAM sam build sam deploy Back to Lambda console Click book_delete function created Click Configuration tab Select Permissions on the left menu Click on the role that the function is executing Expand the policy, see the permissions granted to the function Open Amazon S3 console, the book-image-resize-store bucket created Click to this bucket Click Permissions tab, see the policy added to the bucket Scroll down to bottom, see Cross-origin resource sharing have been configed "
},
{
	"uri": "/3-deploy-lambda-function/",
	"title": "Deploy Lambda function",
	"tags": [],
	"description": "",
	"content": "In this section we will three Lambda functions to write, read, and delete data in DynamoDB with Python based on AWS SAM.\nContent Create DynamoDB table Deploy Lambda function "
},
{
	"uri": "/4-config-api-gw/",
	"title": "Config API Gateway",
	"tags": [],
	"description": "",
	"content": "Next, we will config the API Gateway to interact with the Lambda functions created in the previous section on SAM:\nContent Create GET API Create POST API Create DELETE API "
},
{
	"uri": "/3-deploy-lambda-function/3-2-deploy-lambda-function/3-2-4-resize-image-function/",
	"title": "Resizing image Lmabda function ",
	"tags": [],
	"description": "",
	"content": "In this step we create a new Lambda function that resizes the image after the user uploads it.\nOpen template.yaml file in fcj-book-store folder Add the following script at the end of the file to create resizing image function ImageResizer: Type: AWS::Serverless::Function Properties: CodeUri: fcj-book-store/resize_image/function.zip PackageType: Zip Handler: index.handler Runtime: nodejs16.x FunctionName: resize_image Architectures: - x86_64 Policies: - Statement: - Sid: ResizeUploadImage Effect: Allow Action: - s3:GetObject - s3:PutObject - s3:DeleteObject Resource: - arn:aws:s3:::book-image-store/* - arn:aws:s3:::book-image-resize-store/* Events: ResizeImage: Type: S3 Properties: Bucket: !Ref BookImageStore Events: s3:ObjectCreated:* Environment: Variables: WIDTH: 200 HEIGHT: 280 DES_BUCKET: book-image-resize-store If you create S3 bucket names that are different from the ones in the lab, please check Policies | Resources or Environment of resources and update.\nAdd the following script at the end of the file to grant permission to the books-image-store bucket to use this function LambdaInvokePermission: Type: \u0026#34;AWS::Lambda::Permission\u0026#34; Properties: FunctionName: !GetAtt ImageResizer.Arn Action: \u0026#34;lambda:InvokeFunction\u0026#34; Principal: \u0026#34;s3.amazonaws.com\u0026#34; SourceAccount: !Sub ${AWS::AccountId} SourceArn: !GetAtt BookImageStore.Arn The directory structure is as follows: fcj-book-store ├── fcj-book-store │ ├── books_list │ │ └── books_list.py │ ├── book_create │ │ └── book_create.py │ ├── book_delete │ │ └── book_delete.py │ ├── resize_image │ └── function.zip └── template.yaml Create resize_image folder in fcj-book-store/fcj-book-store/ folder Download the below file and copy to this folder Source code function.zip (8382 ko) Run the following command to deploy SAM sam build sam deploy Back to Lambda console Click resize_image function created Click Configuration tab Select Trigger on the left menu, display S3 bucket - book-image-store Select Permissions on the left menu Click on the role that the function is executing Expand the policy, see the permissions granted to the function "
},
{
	"uri": "/5-test-api-by-postman/",
	"title": "Test APIs by Postman",
	"tags": [],
	"description": "",
	"content": "In this step, we will test operation of the APIs using Postman tool.\nTest the listing API Click + to add a new tab Select GET method Enter URL of the listing API that recorded from the previous step Click Send The returned result is the entire data of the Books table that has been processed Test the writing API Similarly create a new tab Select POST method Enter URL of the writing API that recorded from the previous step In Body pattern, select raw Copy the below text block: { \u0026#34;id\u0026#34;: \u0026#34;5\u0026#34;, \u0026#34;rv_id\u0026#34;: 0, \u0026#34;name\u0026#34;: \u0026#34;Amazon Web Services in Action 2nd Edition\u0026#34;, \u0026#34;author\u0026#34;: \u0026#34;Andreas Wittig\u0026#34;, \u0026#34;price\u0026#34;: \u0026#34;59.99\u0026#34;, \u0026#34;category\u0026#34;: \u0026#34;IT\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;Amazon Web Services in Action, Second Edition is a comprehensive introduction to computing, storing, and networking in the AWS cloud. You\u0026#39;ll find clear, relevant coverage of all the essential AWS services you to know, emphasizing best practices for security, high availability and scalability.\u0026#34;, \u0026#34;image\u0026#34;: \u0026#34;https://book-image-resize-store.s3.ap-southeast-2.amazonaws.com/aws.jpg\u0026#34; } Switch to Headers Add KEY is Content-Type, VALUE is application/json Click Send Wait a moment, see the results returned Open Books table in DynamoDB console to check data Before call the write API After call the write API Test the deleting API Since the delete Lambda function on execution deletes images uploaded by the user, we manually upload the images to the S3 bucket so the API can run properly.\nOpen Amazon S3 console\nClick book-image-store bucket\nClick Upload Click Add files Tải ảnh sau về máy của bạn và chọn nó để tải lên bucket Image aws.jpg (24 ko) 6. Click Upload After the upload is done, switch to book-image-resize-store bucket to check. This is execution result of reszie_image Lambda funtion Back to Postman, add a new tab to call the delete API Select GET method Enter URL of the deleting API that recorded from the previous step, replace /{id} with /5 Click Send Check the returned result: Open Books table in DynamoDB console to check data Open book-image-resize-store bucket to check object. The aws.jpg is deleted "
},
{
	"uri": "/6-test-front-end/",
	"title": "Test APIs with front-end",
	"tags": [],
	"description": "",
	"content": "After testing that the APIs work properly with Postman, we will test the APIs that are called with the front-end built from part 2.\nOpen config.js in fcj-serverless-frontend folder that downloaded from part 2 Change value of APP_API_URL with your URL: Open App.js in fcj-serverless-frontend/src/, change value of isAdmin with true Run the command lines under here: yarn build aws s3 cp build s3://fcj-book-store --recursive Paste the endpoint of S3 static web into your browser. The app already shows the book information, but still no pictures because we haven\u0026rsquo;t uploaded the pictures yet. So the listing API is working properly\nTest writing API Click Management tab Click Update Edit whatever you want except id Click Choose image Upload the below image to the bucket: Image DockerInAction.jpeg (33 ko) Click Update Click OK Image and information updated Click on the Create new book tab to write new data to the database Enter id with 5 Enter name: Amazon Web Services in Action Enter the author: Andreas Wittig Enter category: IT Enter price: 59.99 Enter a description: Amazon Web Services in Action, Second Edition is a comprehensive introduction to computing, storing, and networking in the AWS cloud. You'll find clear, relevant coverage of all the essential AWS services you to know, emphasizing best practices for security, high availability, and scalability. Image aws.jpg (24 ko) Press the Choose File button to upload the image Press the Create button Click OK Display newly created information Test the deleting API Click Management tab Click Update Click Delete Click OK to confirm delete Click OK View results after deleting: no appearing book information We have finished building a simple SAM-based web application following the serverless model.\n"
},
{
	"uri": "/7-cleanup/",
	"title": "Cleanup",
	"tags": [],
	"description": "",
	"content": " Empty S3 bucket Open AWS S3 console Select fcj-book-store Click Empty Enter permanently delete Click Empty Do the same for bucket starting with aws-sam-cli-managed-default- Delete CloudFormation stacks Execute the below command to delete the AWS SAM application sam delete --stack-name fcj-book-store sam delete --stack-name aws-sam-cli-managed-default "
},
{
	"uri": "/categories/",
	"title": "Categories",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "/tags/",
	"title": "Tags",
	"tags": [],
	"description": "",
	"content": ""
}]