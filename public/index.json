[
{
	"uri": "/3-deploy-lambda-function/3-1-create-dynamodb-table/",
	"title": "Create DynamoDB table",
	"tags": [],
	"description": "",
	"content": " Open template.yaml file in fcj-book-store folder Add the following script at the end of the file to create a simple table in DynamoDB:   SimpleTable:\rType: AWS:Serverless::SimpleTable\rProperties:\rTableName: SimpleTable\rPrimaryKey:\rName: id\rType: String\r The script defines a SimpleTable table in DynamoDB with the Partition key is id  Run the following command to deploy SAM  sam build\rsam deploy --guided\rOpen DynamoDB console Select Tables on the left menu. You can see SimpleTable table created  But our table needs more config. So delete the above script and replace it with the following:   BooksTable:\rType: AWS::DynamoDB::Table\rProperties:\rTableName: Books\rBillingMode: PAY_PER_REQUEST\rAttributeDefinitions:\r- AttributeName: id\rAttributeType: S\r- AttributeName: rv_id\rAttributeType: N\r- AttributeName: name\rAttributeType: S\rKeySchema:\r- AttributeName: id\rKeyType: HASH\r- AttributeName: rv_id\rKeyType: RANGE\rLocalSecondaryIndexes:\r- IndexName: name-index\rKeySchema:\r- AttributeName: id\rKeyType: HASH\r- AttributeName: name\rKeyType: RANGE\rProjection:\rProjectionType: ALL\r The above script creates the Books table in DynamoDB with the partition key of id, the sort key of rv_id and a Local Scondary Index.  Run the following command to deploy SAM  sam build\rsam deploy --guided\rBack to DynamoDB console. The Books table have been created and SimpleTable table deleted  Select Books table. Check informations of this table   Click Indexes tab  So you have created the Books table with the Local secondary index of name-index\nTo add data to the table, you can download the below file. Then, open file and replace all AWS-REGION with the region that create S3 bucket - book-image-resize-store, such as: ap-southeast-1  \r\rData\r\r\rdynamoDB.json\r\r(4 ko)\r\r\r\rRun the following command at the directory where you save the dynamoDB.json file  aws dynamodb batch-write-item --request-items file://dynamoDB.json\r"
},
{
	"uri": "/4-config-api-gw/4-1-get-api/",
	"title": "Create GET API",
	"tags": [],
	"description": "",
	"content": " Open template.yaml in fcj-book-store folder Add the following script at the end of the file creating a REST API and GET method   BookApi:\rType: AWS::Serverless::Api\rName: fcj-serverless-api\rProperties:\rStageName: staging\rCors: \u0026quot;'*'\u0026quot; # enable CORS for API\rDefinitionBody:\ropenapi: 3.0.1\rinfo:\rdescription: \u0026quot;This is the APIs for book store web app\u0026quot;\rversion: \u0026quot;1.0.0\u0026quot;\rtitle: \u0026quot;API Gateway REST API to Lambda\u0026quot;\rpaths:\r/books:\rget:\rresponses:\r\u0026quot;200\u0026quot;:\rdescription: 200 response\rheaders:\rAccess-Control-Allow-Origin:\rtype: string\rx-amazon-apigateway-integration:\ruri:\rFn::Sub: \u0026quot;arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${BooksList.Arn}/invocations\u0026quot;\rresponses:\rdefault:\rstatusCode: 200\rresponseParameters:\rmethod.response.header.Access-Control-Allow-Origin: \u0026quot;'*'\u0026quot;\rpassthroughBehavior: when_no_match\rhttpMethod: POST #always POST\rtype: aws_proxy\r Add the following script at the end of the BooksList function   Events:\rListBook:\rType: Api\rProperties:\rPath: /books/\rMethod: get\rRestApiId:\rRef: BookApi\rRun the following command to deploy SAM  sam build\rsam deploy --guided\r\rEnter \u0026ldquo;y\u0026rdquo; if asked \u0026ldquo;BooksList may not have authorization defined, Is this okay? [y/N]: \u0026quot;\n\rOpen Lambda console, click books_list function   Click API Gateway  Show API Gateway being interacted with function   Click this API Gateway  Display resources and GET method  Click Stages on the left menu   Click staging Click GET Record InvokeURL of GET method  "
},
{
	"uri": "/1-preparation/",
	"title": "Preparation",
	"tags": [],
	"description": "",
	"content": "To start building SAM-based applications, we must first install the SAM CLI, install the AWS credentials, and initialize a simple SAM application.\n Install SAM CLI for OS:   MacOS  brew tap aws/tap\rbrew install aws-sam-cli\rsam --version\r Linux  pip install aws-sam-cli\rsam --version\r Windows  Downloads AWS SAM CLI 64-bit Install file and check version of SAM    sam --version\r\rYou can refer to: https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html\n\rIf you have already installed AWS credentials from previous posts, you can skip this step.   Open IAM console   Click User on the left menu. Click Create user button   Enter user name, ví dụ: AdminSAMUser Select Password - AWS Mannagemant Console access of Select AWS credentail type pattern Select Custom password, then enter your password Uncheck the Require password reset Click Next: Permissions   Select Attach existin policies directly Select AdministratorAccess policy to the user has full access to the services Click Next: Tags   Click Next: Review Review configuration, and click Create user   Click on the newly created user.   Click Security credentials tab Click Create access key   Click Download .csv file   Run the command using the terminal on your device  aws configure\r Enter the information corresponding to the columns in the credential file you downloaded  AWS Access key ID: Enter access key ID AWS Secret access key: Enter secret access key Default region name: Enter region closest to you Default output format: Can be overlooked    Then, create a sample SAM project   Run the below commands at the directory where you want to deploy the application  #Step 1 - Download a sample application\rsam init\r Then select the options:  Which template source would you like to use?\r1 - AWS Quick Start Templates\r2 - Custom Template Location\rChoice: 1\rChoose an AWS Quick Start application template\r1 - Hello World Example\r2 - Multi-step workflow\r3 - Serverless API\r4 - Scheduled task\r5 - Standalone function\r6 - Data processing\r7 - Infrastructure event management\r8 - Machine Learning\rTemplate: 1\rUse the most popular runtime and package type? (Python and zip) [y/N]: y\rWould you like to enable X-Ray tracing on the function(s) in your application? [y/N]: n\rProject name [sam-app]: fcj-book-store\rYou have created a sample SAM project. Next , we will edit that project according to our application architecture.\n"
},
{
	"uri": "/",
	"title": "Serverless - SAM-based Application Deployment",
	"tags": [],
	"description": "",
	"content": "Serverless - SAM-based Application Deployment Overview In the first two articles of this series, we know how to build a simple serverless web application using the AWS console. To build the serverless application faster, AWS provides users with the AWS Serverless Application Model (SAM) service, which is an open-source framework for building a serverless applications. It provides shorthand syntax to express functions, APIs, databases, and event source mappings. You define the application you want with just a few lines per resource and model it using YAML. During deployment, SAM transforms and expands the SAM syntax into AWS CloudFormation syntax. Then, CloudFormation provides the resources to the user.\nIn this workshop 3, we will rebuild the web application in workshop 2 with AWS SAM.\nThe architecture of the application we will build:\nContent  Introduction Front-end deployment Deploy Lambda function Config API Gateway Test API by Postman Test API with front-end Cleanup  "
},
{
	"uri": "/3-deploy-lambda-function/3-2-deploy-lambda-function/3-2-2-write-data-function/",
	"title": "Writing Lambda function",
	"tags": [],
	"description": "",
	"content": "Trong bước này chúng ta tạo một Lambda function mới để ghi dữ liệu vào DynamoDB trên SAM\n Open template.yaml file in fcj-book-store folder Add the following script at the end of the file to create a Lambda function that writes data to DynamoDB   BookCreate:\rType: AWS::Serverless::Function\rProperties:\rCodeUri: fcj-book-store/book_create\rHandler: book_create.lambda_handler\rRuntime: python3.9\rFunctionName: book_create\rArchitectures:\r- x86_64\rPolicies:\r- Statement:\r- Sid: BookCreateItem\rEffect: Allow\rAction:\r- dynamodb:PutItem\r- s3:PutObject\rResource:\r- !Sub arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/Books\r- arn:aws:s3:::book-image-store/*\r Add the following script at the end of the file to create an S3 bucket that stores uploaded image files   BookImageStore:\rType: AWS::S3::Bucket\rProperties:\rBucketName: book-image-store\rThe directory structure is as follows:  fcj-book-store\r├── fcj-book-store\r│ ├── books_list\r│ │ └── books_list.py\r│ ├── book_create\r│ └── book_create.py\r└── template.yaml\r Create book_create folder in fcj-book-store/fcj-book-store/ folder Create book_create.py file and copy the below code block to it  import boto3\rimport json\rimport base64\rimport io\rimport cgi\rimport os\rs3 = boto3.client('s3')\rclient = boto3.resource('dynamodb')\rruntime_region = os.environ['AWS_REGION']\rdef get_data_from_request_body(content_type, body):\rfp = io.BytesIO(base64.b64decode(body)) # decode\renviron = {\u0026quot;REQUEST_METHOD\u0026quot;: \u0026quot;POST\u0026quot;}\rheaders = {\r\u0026quot;content-type\u0026quot;: content_type,\r\u0026quot;content-length\u0026quot;: len(body),\r}\rfs = cgi.FieldStorage(fp=fp, environ=environ, headers=headers) return [fs, None]\rdef lambda_handler(event, context):\rcontent_type = event['headers'].get('Content-Type', '') or event['headers'].get('content-type', '')\rif content_type == 'application/json':\rbook_item = json.loads(event[\u0026quot;body\u0026quot;])\relse:\rbook_data, book_data_error = get_data_from_request_body(\rcontent_type=content_type, body=event[\u0026quot;body\u0026quot;]\r)\rname = book_data['image'].filename\rimage = book_data['image'].value\rs3.put_object(Bucket='book-image-store', Key=name, Body=image)\rimage_path = \u0026quot;https://{}.s3.{}.amazonaws.com/{}\u0026quot;.format(\u0026quot;book-image-resize-store\u0026quot;, runtime_region, name)\rbook_item = {\r\u0026quot;id\u0026quot;: book_data['id'].value,\r\u0026quot;rv_id\u0026quot;: 0,\r\u0026quot;name\u0026quot;: book_data['name'].value,\r\u0026quot;author\u0026quot;: book_data['author'].value,\r\u0026quot;price\u0026quot; : book_data['price'].value,\r\u0026quot;category\u0026quot;: book_data['category'].value,\r\u0026quot;description\u0026quot;: book_data['description'].value,\r\u0026quot;image\u0026quot;: image_path\r}\rtable = client.Table('Books')\rtable.put_item(Item = book_item)\rresponse = {\r'statusCode': 200,\r'body': 'successfully created item!',\r'headers': {\r'Content-Type': 'application/json',\r\u0026quot;Access-Control-Allow-Headers\u0026quot;: \u0026quot;Access-Control-Allow-Headers, Origin, Accept, X-Requested-With, Content-Type, Access-Control-Request-Method,X-Access-Token, XKey, Authorization\u0026quot;,\r\u0026quot;Access-Control-Allow-Origin\u0026quot;: \u0026quot;*\u0026quot;,\r\u0026quot;Access-Control-Allow-Methods\u0026quot;: \u0026quot;GET,PUT,POST,DELETE,OPTIONS\u0026quot;\r},\r}\rreturn response\rRun the following command to deploy SAM  sam build\rsam deploy --guided\rBack to AWS Lambda console   Click book_create function created  Click Configuration tab   Select Permissions on the left menu Click on the role that the function is executing  Expand the policy, see the permissions granted to the function  Open Amazon S3 console, the book-image-store bucket has been created  "
},
{
	"uri": "/4-config-api-gw/4-2-post-api/",
	"title": "Create POST API",
	"tags": [],
	"description": "",
	"content": " Open template.yaml file in fcj-book-store folder Add the following script at the end of the file that create the POST method   post:\rresponses:\r\u0026quot;200\u0026quot;:\rdescription: 200 response\rheaders:\rAccess-Control-Allow-Origin:\rtype: string\rx-amazon-apigateway-integration:\ruri:\rFn::Sub: \u0026quot;arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${BookCreate.Arn}/invocations\u0026quot;\rresponses:\rdefault:\rstatusCode: 200\rresponseParameters:\rmethod.response.header.Access-Control-Allow-Origin: \u0026quot;'*'\u0026quot;\rpassthroughBehavior: when_no_match\rhttpMethod: POST #always POST\rtype: aws_proxy\r Add the following script at the end of the BookCreate function   Events:\rCreateBook:\rType: Api\rProperties:\rPath: /books/\rMethod: post\rRestApiId:\rRef: BookApi\rRun the following command to deploy SAM  sam build\rsam deploy --guided\r\rEnter \u0026ldquo;y\u0026rdquo; if asked \u0026ldquo;BookCreate may not have authorization defined, Is this okay? [y/N]:\u0026rdquo;\n\rOpen book_create function console   Click API Gateway  Show API Gateway being interacted with this function   Click this API Gateway  Display the resources and POST method  Click Stages on the left menu   Click staging Click POST Record InvokeURL of POST method  "
},
{
	"uri": "/2-front-end-deployment/",
	"title": "Deploy front-end",
	"tags": [],
	"description": "",
	"content": "In this step, we will create an S3 bucket with Static web hosting enabled and publicly accessible based on SAM:\n Open template.yaml file in fcj-book-store folder that we created in part 1.   Delete unnecessary part:  Copy the following script into that file:  FcjBookStore:\rType: AWS::S3::Bucket\rProperties:\rAccessControl: PublicRead\rBucketName: fcj-book-store\rWebsiteConfiguration:\rIndexDocument: index.html\rFcjBookStorePolicy:\rType: AWS::S3::BucketPolicy\rProperties:\rBucket: !Ref FcjBookStore\rPolicyDocument:\rVersion: 2012-10-17\rStatement:\r- Action: - 's3:GetObject'\rEffect: Allow\rPrincipal: '*'\rResource: !Join\r- ''\r- - 'arn:aws:s3:::'\r- !Ref FcjBookStore\r- /*\rThe above script defines an S3 bucket is fcj-book-store with FcjBookStorePolicy policy - allow public access\nRun the below command to build at the directory of the SAM project: fcj-book-store  sam build\r Run the following command to check the validation of the SAM template  sam validate\r Run the following command to deploy SAM  sam deploy --guided\r Enter stack name: fcj-book-store Enter the deployemnt region, such as: ap-southeast-1- should be the same as the default region Then enter other information as shown below   Wait a while to create the CloudFormation stack changeset Enter \u0026ldquo;y\u0026rdquo; when Deploy this changeset? display  Open Amazon S3 console  Check if the bucket has been created or not.   Click fcj-book-store bucket  Click Properties tab  Scroll down, check state of Static website hosting   Record the endpoint of the website   Click Permissions tab   See the policy has been added  Open CloudFormation console  Two stacks have been created   Click fcj-book-store stack  Click Resource tab, see the resources that CloudFormation has initialized   Click to other stack:  Download fcj-serverless-frontend code to your device   Open a terminal on your computer at the directory where you want to save the source code Copy the below command  git clone https://github.com/AWS-First-Cloud-Journey/FCJ-Serverless-Workshop.git\rcd FCJ-Serverless-Workshop\ryarn build\rWe have finished building the front-end. Next, execute the following command to upload the build folder to S3  aws s3 cp build s3://fcj-book-store --recursive\rResult after uploading:\n"
},
{
	"uri": "/3-deploy-lambda-function/3-2-deploy-lambda-function/",
	"title": "Deploy Lambda function",
	"tags": [],
	"description": "",
	"content": "In this step, we will create Lambda functions to read, write, and delete data in DynamoDB. Then grant the necessary permissions to those functions.\nNội dung  Update writing Lambda function Create listing Lambda function Create deleting Lambda function  "
},
{
	"uri": "/3-deploy-lambda-function/3-2-deploy-lambda-function/3-2-1-list-data-function/",
	"title": "Listing Lambda function",
	"tags": [],
	"description": "",
	"content": "We will create a Lambda function that reads all the data in the DynamoDB table:\n Open template.yaml file in fcj-book-store folder Add the following script at the end of the file   BooksList:\rType: AWS::Serverless::Function\rProperties:\rCodeUri: fcj-book-store/books_list\rHandler: books_list.lambda_handler\rRuntime: python3.9\rFunctionName: books_list\rArchitectures:\r- x86_64\rPolicies:\r- Statement:\r- Sid: ReadDynamoDB\rEffect: Allow\rAction:\r- dynamodb:Scan\r- dynamodb:Query\rResource:\r- !Sub arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/Books\rThe directory structure is as follows:  fcj-book-store\r├── fcj-book-store\r│ ├── books_list\r│ └── books_list.py\r└── template.yaml\r Create fcj-book-store/books_list folder in fcj-book-store folder Create books_list.py file and copy the below code block to it  import json\rimport boto3\rfrom decimal import *\rfrom boto3.dynamodb.types import TypeDeserializer\rclient = boto3.client('dynamodb') serializer = TypeDeserializer()\rclass DecimalEncoder(json.JSONEncoder):\rdef default(self, obj):\rif isinstance(obj, Decimal):\rreturn str(obj)\rreturn json.JSONEncoder.default(self, obj)\rdef deserialize(data):\rif isinstance(data, list):\rreturn [deserialize(v) for v in data]\rif isinstance(data, dict):\rtry:\rreturn serializer.deserialize(data)\rexcept TypeError:\rreturn {k: deserialize(v) for k, v in data.items()}\relse:\rreturn data\rdef lambda_handler(event, context):\rdata_books = client.scan(\rTableName='Books',\rIndexName='name-index'\r)\rformat_data_books = deserialize(data_books[\u0026quot;Items\u0026quot;])\rfor book in format_data_books:\rdata_comment = client.query(\rTableName=\u0026quot;Books\u0026quot;, KeyConditionExpression=\u0026quot;id = :id AND rv_id \u0026gt; :rv_id\u0026quot;, ExpressionAttributeValues={\r\u0026quot;:id\u0026quot;: {\u0026quot;S\u0026quot;: book['id']}, \u0026quot;:rv_id\u0026quot;: {\u0026quot;N\u0026quot;: \u0026quot;0\u0026quot;}\r}\r)\rformat_data_comment = deserialize(data_comment['Items'])\rprint(data_comment['Items'])\rbook[\u0026quot;comments\u0026quot;] = format_data_comment\rprint (format_data_books)\rreturn {\r\u0026quot;statusCode\u0026quot;: 200,\r\u0026quot;headers\u0026quot;: {\r\u0026quot;Content-Type\u0026quot;: \u0026quot;application/json\u0026quot;,\r\u0026quot;Access-Control-Allow-Origin\u0026quot;: \u0026quot;*\u0026quot;,\r\u0026quot;Access-Control-Allow-Methods\u0026quot;: \u0026quot;GET,PUT,POST,DELETE, OPTIONS\u0026quot;,\r\u0026quot;Access-Control-Allow-Headers\u0026quot;: \u0026quot;Access-Control-Allow-Headers, Origin,Accept, X-Requested-With, Content-Type, Access-Control-Request-Method,X-Access-Token,XKey,Authorization\u0026quot;\r},\r\u0026quot;body\u0026quot;: json.dumps(format_data_books, cls=DecimalEncoder)\r}\rRun the following command to deploy SAM  sam build\rsam deploy --guided\rOpen AWS Lambda console  Click books_list function created  Click Configuration tab   Select Permissions on the left menu Click on the role that the function is executing  Expand the policy, see the permissions granted to the function  "
},
{
	"uri": "/4-config-api-gw/4-3-delete-api/",
	"title": "Create DELETE API",
	"tags": [],
	"description": "",
	"content": " Open template.yaml file in fcj-book-store folder Add the following script at the end of the file that create the DELETE method   /books/{id}:\rdelete:\rresponses:\r\u0026quot;200\u0026quot;:\rdescription: 200 response\rheaders:\rAccess-Control-Allow-Origin:\rtype: string\rx-amazon-apigateway-integration:\ruri:\rFn::Sub: \u0026quot;arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${BookDelete.Arn}/invocations\u0026quot;\rresponses:\rdefault:\rstatusCode: 200\rresponseParameters:\rmethod.response.header.Access-Control-Allow-Origin: \u0026quot;'*'\u0026quot;\rpassthroughBehavior: when_no_match\rhttpMethod: POST #always POST\rtype: aws_proxy\r Add the following script at the end of the BookDelete function   Events:\rDeleteBook:\rType: Api\rProperties:\rPath: /books/{id}\rMethod: delete\rRestApiId:\rRef: BookApi\rRun the following command to deploy SAM  sam build\rsam deploy --guided\r\rEnter \u0026ldquo;y\u0026rdquo; if asked \u0026ldquo;BookDelete may not have authorization defined, Is this okay? [y/N]: \u0026quot;\n\rOpen book_delete function console   Click API Gateway  Show API Gateway being interacted with this function   Click this API Gateway  Display the resources and DELETE method  Click Stages on the left menu   Click staging Click DELTE Record the InvokeURL of DELETE method  Add the following script at the end of the template.yaml file to API can support Binary Media Types files   BinaryMediaTypes: - multipart~1form-data\rRun the following command to deploy SAM  sam build\rsam deploy --guided\rBack to API console   Select Settings on the left menu Scroll down, check if multipart/form-data has been added under Binary Meida Types  "
},
{
	"uri": "/3-deploy-lambda-function/3-2-deploy-lambda-function/3-2-3-delete-data-function/",
	"title": "Deleting Lambda function",
	"tags": [],
	"description": "",
	"content": "We will create a Lambda function that deletes all items with the specified partition key and sort key in the DynamoDB table. And delete the image file in the S3 bucket:\n Open template.yaml file in fcj-book-store folder Add the following script at the end of the file to create a Lambda function that deletes data of DynamoDB table   BookDelete:\rType: AWS::Serverless::Function\rProperties:\rCodeUri: fcj-book-store/book_delete\rHandler: book_delete.lambda_handler\rRuntime: python3.9\rFunctionName: book_delete\rArchitectures:\r- x86_64\rPolicies:\r- Statement:\r- Sid: VisualEditor0\rEffect: Allow\rAction:\r- dynamodb:DeleteItem\r- dynamodb:GetItem\r- dynamodb:Query\r- s3:DeleteObject\rResource:\r- !Sub arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/Books\r- arn:aws:s3:::book-image-resize-store/*\r Add the following script at the end of the file to create an S3 bucket that saves the image after resizing with CORS rule and policy settings   BookImageResizeStore:\rType: AWS::S3::Bucket\rProperties:\rAccessControl: PublicRead\rBucketName: book-image-resize-store\rCorsConfiguration:\rCorsRules:\r- AllowedHeaders:\r- '*'\rAllowedMethods:\r- GET\r- PUT\r- POST\r- DELETE\rAllowedOrigins:\r- '*'\rBookImageResizeStorePolicy:\rType: AWS::S3::BucketPolicy\rProperties:\rBucket: !Ref BookImageResizeStore\rPolicyDocument:\rVersion: 2012-10-17\rStatement:\r- Action: - 's3:GetObject'\rEffect: Allow\rPrincipal: '*'\rResource: !Join\r- ''\r- - 'arn:aws:s3:::'\r- !Ref BookImageResizeStore\r- /*\rThe directory structure is as follows:  fcj-book-store\r├── fcj-book-store\r│ ├── books_list\r│ │ └── books_list.py\r│ ├── book_create\r│ │ └── book_create.py\r│ └── book_delete\r│ └── book_delete.py\r└── template.yaml\r Create book_delete folder in fcj-book-store/fcj-book-store/ folder Create book_delete.py file and copy the below code block to it  import boto3\rimport json\rs3 = boto3.client('s3')\rclient = boto3.resource('dynamodb')\rdef get_image_name(image_path):\rstr_image = image_path.split(\u0026quot;/\u0026quot;)\rfor image_path_item in str_image:\rimage_name = image_path_item\rreturn image_name;\rdef lambda_handler(event, context):\rerror = None\rstatus = 200\rdelete_id = event['pathParameters']\rdelete_id['rv_id'] = 0\rtable = client.Table(\u0026quot;Books\u0026quot;)\rimage_path = \u0026quot;\u0026quot;\rtry:\rdata = table.get_item(Key = delete_id)\rimage_path = data['Item']['image']\rimage_name = get_image_name(image_path)\rexcept Exception as e:\rerror = e\rtry:\rresponse = table.query(\rProjectionExpression=\u0026quot;rv_id\u0026quot;, KeyConditionExpression=\u0026quot;id = :id\u0026quot;, ExpressionAttributeValues={\u0026quot;:id\u0026quot;: delete_id['id']})\rfor item in response['Items']:\rdelete_id['rv_id'] = item['rv_id']\rprint(delete_id)\rtable.delete_item(Key = delete_id)\rprint(image_name)\rs3.delete_object(Bucket='book-image-resize-store', Key=image_name)\rexcept Exception as e:\rerror = e\rif error is None:\rmessage = 'successfully deleted item!'\relse:\rmessage = 'delete item fail'\rstatus = 400\rreturn {\r'statusCode': status,\r'body': message,\r'headers': {\r'Content-Type': 'application/json',\r'Access-Control-Allow-Origin': '*'\r},\r}\rRun the following command to deploy SAM  sam build\rsam deploy --guided\rBack to Lambda console   Click book_delete function created  Click Configuration tab   Select Permissions on the left menu Click on the role that the function is executing  Expand the policy, see the permissions granted to the function  Open Amazon S3 console, the book-image-resize-store bucket created   Click to this bucket  Click Permissions tab, see the policy added to the bucket  Scroll down to bottom, see Cross-origin resource sharing have been configed  "
},
{
	"uri": "/3-deploy-lambda-function/",
	"title": "Deploy Lambda function",
	"tags": [],
	"description": "",
	"content": "In this section we will three Lambda functions to write, read, and delete data in DynamoDB with Python based on AWS SAM.\nContent  Create DynamoDB table Deploy Lambda function  "
},
{
	"uri": "/4-config-api-gw/",
	"title": "Config API Gateway",
	"tags": [],
	"description": "",
	"content": "Next, we will config the API Gateway to interact with the Lambda functions created in the previous section on SAM:\nNội dung  Create GET API Create POST API Create DELETE API  "
},
{
	"uri": "/3-deploy-lambda-function/3-2-deploy-lambda-function/3-2-4-resize-image-function/",
	"title": "Resizing image Lmabda function ",
	"tags": [],
	"description": "",
	"content": "In this step we create a new Lambda function that resizes the image after the user uploads it.\n Open template.yaml file in fcj-book-store folder Add the following script at the end of the file to create resizing image function  ImageResizer:\rType: AWS::Serverless::Function\rProperties:\rCodeUri: fcj-book-store/resize_image/function.zip\rPackageType: Zip\rHandler: index.handler\rRuntime: nodejs16.x\rFunctionName: resize_image\rArchitectures:\r- x86_64\rPolicies:\r- Statement:\r- Sid: ResizeUploadImage\rEffect: Allow\rAction:\r- s3:GetObject\r- s3:PutObject\r- s3:DeleteObject\rResource:\r- arn:aws:s3:::book-image-store/*\r- arn:aws:s3:::book-image-resize-store/*\rEvents:\rResizeImage:\rType: S3\rProperties:\rBucket: !Ref BookImageStore\rEvents: s3:ObjectCreated:*\rEnvironment:\rVariables:\rWIDTH: 200\rHEIGHT: 280\rDES_BUCKET: book-image-resize-store\r Add the following script at the end of the file to grant permission to the books-image-store bucket to use this function  LambdaInvokePermission:\rType: \u0026quot;AWS::Lambda::Permission\u0026quot;\rProperties:\rFunctionName: !GetAtt ImageResizer.Arn\rAction: \u0026quot;lambda:InvokeFunction\u0026quot;\rPrincipal: \u0026quot;s3.amazonaws.com\u0026quot;\rSourceAccount: !Sub ${AWS::AccountId}\rSourceArn: !GetAtt BookImageStore.Arn\rThe directory structure is as follows:  fcj-book-store\r├── fcj-book-store\r│ ├── books_list\r│ │ └── books_list.py\r│ ├── book_create\r│ │ └── book_create.py\r│ ├── book_delete\r│ │ └── book_delete.py\r│ ├── resize_image\r│ └── function.zip\r└── template.yaml\r Create resize_image folder in fcj-book-store/fcj-book-store/ folder Download the below file and copy to this folder  \r\rSource code\r\r\rfunction.zip\r\r(8382 ko)\r\r\r\rRun the following command to deploy SAM  sam build\rsam deploy --guided\rBack to Lambda console   Click resize_image function created  Click Configuration tab   Select Trigger on the left menu, display S3 bucket - book-image-store  Select Permissions on the left menu   Click on the role that the function is executing  Expand the policy, see the permissions granted to the function  "
},
{
	"uri": "/5-test-api-by-postman/",
	"title": "Test APIs by Postman",
	"tags": [],
	"description": "",
	"content": "In this step, we will test operation of the APIs using Postman tool.\nTest the listing API  Click + to add a new tab   Select GET method Enter URL of the listing API that recorded from the previous step Click Send  The returned result is the entire data of the Books table that has been processed  Test the writing API  Similarly create a new tab   Select POST method Enter URL of the writing API that recorded from the previous step In Body pattern, select raw Copy the below text block:  {\r\u0026quot;id\u0026quot;: \u0026quot;5\u0026quot;,\r\u0026quot;rv_id\u0026quot;: 0,\r\u0026quot;name\u0026quot;: \u0026quot;Amazon Web Services in Action 2nd Edition\u0026quot;,\r\u0026quot;author\u0026quot;: \u0026quot;Andreas Wittig\u0026quot;,\r\u0026quot;price\u0026quot;: \u0026quot;59.99\u0026quot;,\r\u0026quot;category\u0026quot;: \u0026quot;IT\u0026quot;,\r\u0026quot;description\u0026quot;: \u0026quot;Amazon Web Services in Action, Second Edition is a comprehensive introduction to computing, storing, and networking in the AWS cloud. You'll find clear, relevant coverage of all the essential AWS services you to know, emphasizing best practices for security, high availability and scalability.\u0026quot;,\r\u0026quot;image\u0026quot;: \u0026quot;https://book-image-resize-store.s3.ap-southeast-2.amazonaws.com/aws.jpg\u0026quot;\r}\rSwitch to Headers   Add KEY is Content-Type, VALUE is application/json Click Send  Wait a moment, see the results returned  Open Books table in DynamoDB console to check data   Before call the write API   After call the write API  Test the deleting API Since the delete Lambda function on execution deletes images uploaded by the user, we manually upload the images to the S3 bucket so the API can run properly.\n  Open Amazon S3 console\n  Click book-image-store bucket\n  Click Upload  Click Add files  Tải ảnh sau về máy của bạn và chọn nó để tải lên bucket  \r\r\rImage\r\r\raws.jpg\r\r(24 ko)\r\r\r\r6. Click Upload After the upload is done, switch to book-image-resize-store bucket to check. This is execution result of reszie_image Lambda funtion  Back to Postman, add a new tab to call the delete API   Select GET method Enter URL of the deleting API that recorded from the previous step, replace /{id} with /5 Click Send  Check the returned result:  Open Books table in DynamoDB console to check data  Open book-image-resize-store bucket to check object. The aws.jpg is deleted  "
},
{
	"uri": "/6-test-front-end/",
	"title": "Test APIs with front-end",
	"tags": [],
	"description": "",
	"content": "After testing that the APIs work properly with Postman, we will test the APIs that are called with the front-end built from part 2.\n Open config.js in fcj-serverless-frontend folder that downloaded from part 2   Change value of APP_API_URL with your URL:  Open App.js in fcj-serverless-frontend/src/, change value of isAdmin with true Run the command lines under here:  yarn build\raws s3 cp build s3://fcj-book-store --recursive\rPaste the endpoint of S3 static web into your browser. The app already shows the book information, but still no pictures because we haven\u0026rsquo;t uploaded the pictures yet.  So the listing API is working properly\nTest writing API   Click Management tab Click Update   Edit whatever you want except id Click Choose image Upload the below image to the bucket: \r\rImage\r\r\rDockerInAction.jpeg\r\r(33 ko)\r\r\r\r Click Update   Click OK   Image and information updated   Click on the Create new book tab to write new data to the database Enter id with 5 Enter name: Amazon Web Services in Action Enter the author: Andreas Wittig Enter category: IT Enter price: 59.99 Enter a description: Amazon Web Services in Action, Second Edition is a comprehensive introduction to computing, storing, and networking in the AWS cloud. You\u0026rsquo;ll find clear, relevant coverage of all the essential AWS services you to know, emphasizing best practices for security, high availability, and scalability.  \r\rImage\r\r\raws.jpg\r\r(24 ko)\r\r\r\r Press the Choose File button to upload the image Press the Create button   Click OK   Display newly created information   Test the deleting API   Click Management tab Click Update   Click Delete   Click OK to confirm delete   Click OK   View results after deleting: no appearing book information  We have finished building a simple SAM-based web application following the serverless model.\n"
},
{
	"uri": "/7-cleanup/",
	"title": "Cleanup",
	"tags": [],
	"description": "",
	"content": " Empty S3 bucket   Open AWS S3 console Select fcj-book-store Click Empty Enter permanently delete Click Empty Do the same for bucket starting with aws-sam-cli-managed-default-  Delete CloudFormation stacks   Execute the below command to delete the AWS SAM application  sam delete --stack-name fcj-book-store\rsam delete --stack-name aws-sam-cli-managed-default\r"
},
{
	"uri": "/categories/",
	"title": "Categories",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "/tags/",
	"title": "Tags",
	"tags": [],
	"description": "",
	"content": ""
}]