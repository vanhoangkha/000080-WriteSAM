[
{
	"uri": "/vi/1-preparation/",
	"title": "Chuẩn bị",
	"tags": [],
	"description": "",
	"content": "Để bắt đầu xây dựng các ứng dụng dựa trên SAM, đầu tiên chúng ta phải cài đặt SAM CLI, cài đặt AWS credentials và khởi tạo một SAM application đơn giản.\n Cài đặt SAM CLI cho hệ điều hành   MacOS  brew tap aws/tap\rbrew install aws-sam-cli\rsam --version  Linux  pip install aws-sam-cli\rsam --version  Windows  Tải tệp cài đặt AWS SAM CLI 64-bit Cài đặt tệp và kiểm tra version của SAM    sam --version \rBạn có thể tham khảo tại: https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html\n\rNếu bạn đã cài đặt AWS credentials từ những bài trước thì có thể bỏ qua bước này.   Mở bảng điều khiển của IAM   Ấn vào User ở menu phía bên trái Ấn nút Create user   Nhập tên người dùng, ví dụ: AdminSAMUser Chọn Password - AWS Mannagemant Console access tại mục Select AWS credentail type Chọn Custom password, sau đó nhập mật khẩu của bạn Bỏ chọn mục Require password reset Ấn nút Next: Permissions   Chọn Attach existin policies directly Chọn policy AdministratorAccess để người dùng có toàn bộ quyền truy cập vào các service Ấn Next: Tags   Ấn Next: Review Xem lại các thiết lập, và ấn Create user   Ấn vào người dùng vừa được tạo.   Ấn sang tab Security credentials Ấn nút Create access key   Ấn nút Download .csv file   Chạy câu lệnh bằng terminal trên máy của bạn  aws configure  Nhập thông tin tương ứng với các cột trong tệp credential mà bạn tải về  AWS Access key ID: Nhập access key ID AWS Secret access key: Nhập secret access key Default region name: Nhập region gần bạn nhất Default output format: Có thể bỏ qua    Sau đó, khởi tạo một project SAM mẫu   Chạy các dòng lệnh dưới đây tại thư mục bạn muốn triển khai ứng dụng  #Step 1 - Download a sample application\rsam init  Sau đó chọn các tuỳ chọn:  Which template source would you like to use?\r1 - AWS Quick Start Templates\r2 - Custom Template Location\rChoice: 1\rChoose an AWS Quick Start application template\r1 - Hello World Example\r2 - Multi-step workflow\r3 - Serverless API\r4 - Scheduled task\r5 - Standalone function\r6 - Data processing\r7 - Infrastructure event management\r8 - Machine Learning\rTemplate: 1\rUse the most popular runtime and package type? (Python and zip) [y/N]: y\rWould you like to enable X-Ray tracing on the function(s) in your application? [y/N]: n\rProject name [sam-app]: fcj-book-store Bạn đã tạo khởi tạo một project SAM mẫu. Bước tiếp theo chúng ta sẽ chỉnh sửa project đó theo kiến trúc ứng dụng của mình.\n"
},
{
	"uri": "/vi/3-deploy-lambda-function/3-2-deploy-lambda-function/3-2-1-list-data-function/",
	"title": "Lambda function đọc dữ liệu",
	"tags": [],
	"description": "",
	"content": "Chúng ta sẽ tạo một Lambda function đọc toàn bộ dữ liệu trong bảng của DynamoDB:\n Mở tệp template.yaml trong thư mục fcj-book-store Thêm đoạn script sau vào cuối tệp   BooksList: Type: AWS::Serverless::Function Properties: CodeUri: fcj-book-store/books_list Handler: books_list.lambda_handler Runtime: python3.9 FunctionName: books_list Architectures: - x86_64 Policies: - Statement: - Sid: ReadDynamoDB Effect: Allow Action: - dynamodb:Scan - dynamodb:Query Resource: - !Sub arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/Books Cấu trúc thư mục như sau:  fcj-book-store ├── fcj-book-store │ ├── books_list │ ├── books_list.py └── template.yaml  Tạo thư mục tên fcj-book-store/books_list trong thư mục fcj-book-store Tạo file books_list.py và sao chép đoạn code sau vào nó  import json import boto3 from decimal import * from boto3.dynamodb.types import TypeDeserializer client = boto3.client(\u0026#39;dynamodb\u0026#39;) serializer = TypeDeserializer() class DecimalEncoder(json.JSONEncoder): def default(self, obj): if isinstance(obj, Decimal): return str(obj) return json.JSONEncoder.default(self, obj) def deserialize(data): if isinstance(data, list): return [deserialize(v) for v in data] if isinstance(data, dict): try: return serializer.deserialize(data) except TypeError: return {k: deserialize(v) for k, v in data.items()} else: return data def lambda_handler(event, context): data_books = client.scan( TableName=\u0026#39;Books\u0026#39;, IndexName=\u0026#39;name-index\u0026#39; ) format_data_books = deserialize(data_books[\u0026#34;Items\u0026#34;]) for book in format_data_books: data_comment = client.query( TableName=\u0026#34;Books\u0026#34;, KeyConditionExpression=\u0026#34;id = :id AND rv_id \u0026gt; :rv_id\u0026#34;, ExpressionAttributeValues={ \u0026#34;:id\u0026#34;: {\u0026#34;S\u0026#34;: book[\u0026#39;id\u0026#39;]}, \u0026#34;:rv_id\u0026#34;: {\u0026#34;N\u0026#34;: \u0026#34;0\u0026#34;} } ) format_data_comment = deserialize(data_comment[\u0026#39;Items\u0026#39;]) print(data_comment[\u0026#39;Items\u0026#39;]) book[\u0026#34;comments\u0026#34;] = format_data_comment print (format_data_books) return { \u0026#34;statusCode\u0026#34;: 200, \u0026#34;headers\u0026#34;: { \u0026#34;Content-Type\u0026#34;: \u0026#34;application/json\u0026#34;, \u0026#34;Access-Control-Allow-Origin\u0026#34;: \u0026#34;*\u0026#34;, \u0026#34;Access-Control-Allow-Methods\u0026#34;: \u0026#34;GET,PUT,POST,DELETE, OPTIONS\u0026#34;, \u0026#34;Access-Control-Allow-Headers\u0026#34;: \u0026#34;Access-Control-Allow-Headers, Origin,Accept, X-Requested-With, Content-Type, Access-Control-Request-Method,X-Access-Token,XKey,Authorization\u0026#34; }, \u0026#34;body\u0026#34;: json.dumps(format_data_books, cls=DecimalEncoder) } Chạy dòng lệnh dưới đây triển khai SAM  sam build sam deploy --guided Mở bảng điều khiển của AWS Lambda  Ấn vào books_list function đã được tạo  Ấn sang tab Configuration   Chọn Permissions ở menu phía bên trái Ấn vào role mà function đang thực hiện  Mở rộng policy, thấy các quyền đã được cấp cho function  "
},
{
	"uri": "/vi/",
	"title": "Serverless - Triển khai ứng dụng bằng SAM",
	"tags": [],
	"description": "",
	"content": "Serverless - Triển khai ứng dụng trên SAM Tổng quan Trong hai bài đầu tiên của series này, chúng ta đã tìm hiểu cách xây dựng một ứng dụng web đơn giản theo mô hình serverless trên cách sử dụng bảng điều khiển của AWS. Để xây dựng ứng dụng serverless nhanh hơn, AWS cung cấp cho người dùng dịch vụ AWS Serverless Application Model (SAM) - là một open-source framework để xây dựng một ứng dụng serverless. SAM cung cấp cú pháp để diễn đạt các hàm, API, cơ sở dữ liệu và event source mappings. Chỉ với vài dòng cho mỗi tài nguyên, bạn có thể xác định ứng dụng bạn muốn và lập mô hình ứng dụng đó bằng YAML. Trong quá trình triển khai, SAM chuyển đổi và mở rộng cú pháp SAM thành cú pháp của AWS CloudFormation. Sau đó, CloudFormation cung cấp các tài nguyên cho người dùng.\nTrong bài số 3 này, chúng ta sẽ cùng nhau xây dựng lại ứng dụng web ở bài số 2 với AWS SAM.\nKiến trúc của ứng dụng chúng ta sẽ xây dựng:\nNội dung  Chuẩn bị Triển khai front-end Triển khai Lambda function Cấu hình API Gateway Kiểm tra API với Postman Kiểm tra API với front-end Dọn dẹp tài nguyên  "
},
{
	"uri": "/vi/3-deploy-lambda-function/3-1-create-dynamodb-table/",
	"title": "Tạo bảng trong DynamoDB",
	"tags": [],
	"description": "",
	"content": " Mở tệp template.yaml trong thư mục fcj-book-store Thêm đoạn script sau vào cuối tệp để tạo một bảng đơn giản trong DynamoDB:   SimpleTable: Type: AWS:Serverless::SimpleTable Properties: TableName: SimpleTable PrimaryKey: Name: id Type: String  Đoạn script định nghĩa một bảng SimpleTable trong DynamoDB với Partition key là id  Chạy dòng lệnh dưới đây triển khai SAM  sam build sam deploy --guided Mở bảng điều khiển của DynamoDB Chọn Tables ở menu phía bên trái. Bạn sẽ thấy SimpleTable đã được tạo  Nhưng bảng của chúng ta cần nhiều thiết lập hơn. Vì vậy bạn hãy xoá đoạn script trên đi thay bằng đoạn sau:   BooksTable: Type: AWS::DynamoDB::Table Properties: TableName: Books BillingMode: PAY_PER_REQUEST AttributeDefinitions: - AttributeName: id AttributeType: S - AttributeName: rv_id AttributeType: N - AttributeName: name AttributeType: S KeySchema: - AttributeName: id KeyType: HASH - AttributeName: rv_id KeyType: RANGE LocalSecondaryIndexes: - IndexName: name-index KeySchema: - AttributeName: id KeyType: HASH - AttributeName: name KeyType: RANGE Projection: ProjectionType: ALL  Đoạn script trên giúp tạo bảng Books trong DynamoDB với partition key là id, sort key là rv_id và một Local Scondary Index.  Chạy dòng lệnh dưới đây triển khai SAM  sam build sam deploy --guided Quay lại với bảng điều khiển của DynamoDB. Bảng Books đã được tạo và bảng SimpleTable đã xoá.  Ấn chọn bảng Books. Kiểm tra các thông tin của bảng   Ấn sang tab Indexes  Vậy là bạn đã tạo xong bảng Books với Local secondary index là name-index\nĐể thêm dữ liệu cho bảng, bạn có thể tải tệp dưới đây. Mở tệp, sau đó thay toàn bộ AWS-REGION bằng vùng mà bạn tạo S3 bucket book-image-resize-store, ví dụ: ap-southeast-1  \r\rData\r\r\rdynamoDB.json\r\r(4 ko)\r\r\r\rChạy câu lệnh sau tại thư mục mà bạn lưu tệp dynamoDB.json  aws dynamodb batch-write-item --request-items file://dynamoDB.json "
},
{
	"uri": "/vi/4-config-api-gw/4-1-get-api/",
	"title": "Tạo GET API",
	"tags": [],
	"description": "",
	"content": " Mở tệp template.yaml trong thư mục fcj-book-store Thêm đoạn script sau vào cuối tệp tạo một REST API và GET method   BookApi: Type: AWS::Serverless::Api Name: fcj-serverless-api Properties: StageName: staging Cors: \u0026#34;\u0026#39;*\u0026#39;\u0026#34; # enable CORS for API DefinitionBody: openapi: 3.0.1 info: description: \u0026#34;This is the APIs for book store web app\u0026#34; version: \u0026#34;1.0.0\u0026#34; title: \u0026#34;API Gateway REST API to Lambda\u0026#34; paths: /books: get: responses: \u0026#34;200\u0026#34;: description: 200 response headers: Access-Control-Allow-Origin: type: string x-amazon-apigateway-integration: uri: Fn::Sub: \u0026#34;arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${BooksList.Arn}/invocations\u0026#34; responses: default: statusCode: 200 responseParameters: method.response.header.Access-Control-Allow-Origin: \u0026#34;\u0026#39;*\u0026#39;\u0026#34; passthroughBehavior: when_no_match httpMethod: POST #always POST type: aws_proxy  Thêm đoạn script sau vào cuối của function BooksList   Events: ListBook: Type: Api Properties: Path: /books/ Method: get RestApiId: Ref: BookApi Chạy dòng lệnh dưới đây triển khai SAM  sam build sam deploy --guided \rNhập \u0026ldquo;y\u0026rdquo; nếu được hỏi \u0026ldquo;BooksList may not have authorization defined, Is this okay? [y/N]: \u0026quot;\n\rMở bảng điều khiển của function books_list   Ấn vào API Gateway  Hiện thị API Gateway đang được tương tác với function   Ấn vào API Gateway đó  Hiện thị các resource và GET method  Chọn tab Stages ở menu phía bên trái   Ấn chọn staging Ấn chọn GET Ghi lại InvokeURL của method GET  "
},
{
	"uri": "/vi/3-deploy-lambda-function/3-2-deploy-lambda-function/3-2-2-write-data-function/",
	"title": "Lambda function ghi dữ liệu",
	"tags": [],
	"description": "",
	"content": "Trong bước này chúng ta tạo một Lambda function mới để ghi dữ liệu vào DynamoDB trên SAM\n Mở tệp template.yaml trong thư mục fcj-book-store Thêm đoạn script sau vào cuối tệp để tạo Lambda function ghi dữ liệu vào DynamoDB   BookCreate: Type: AWS::Serverless::Function Properties: CodeUri: fcj-book-store/book_create Handler: book_create.lambda_handler Runtime: python3.9 FunctionName: book_create Architectures: - x86_64 Policies: - Statement: - Sid: BookCreateItem Effect: Allow Action: - dynamodb:PutItem - s3:PutObject Resource: - !Sub arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/Books - arn:aws:s3:::book-image-store/*  Thêm đoạn script sau vào cuối tệp để tạo S3 bucket lưu tập ảnh người dùng tải lên   BookImageStore: Type: AWS::S3::Bucket Properties: BucketName: book-image-store Cấu trúc thư mục như sau:  fcj-book-store ├── fcj-book-store │ ├── books_list │ │ └── books_list.py │ ├── book_create │ └── book_create.py └── template.yaml  Tạo thư mục tên book_create trong thư mục fcj-book-store/fcj-book-store/ Tạo file book_create.py và sao chép đoạn code sau vào nó  import boto3 import json import base64 import io import cgi import os s3 = boto3.client(\u0026#39;s3\u0026#39;) client = boto3.resource(\u0026#39;dynamodb\u0026#39;) runtime_region = os.environ[\u0026#39;AWS_REGION\u0026#39;] def get_data_from_request_body(content_type, body): fp = io.BytesIO(base64.b64decode(body)) # decode environ = {\u0026#34;REQUEST_METHOD\u0026#34;: \u0026#34;POST\u0026#34;} headers = { \u0026#34;content-type\u0026#34;: content_type, \u0026#34;content-length\u0026#34;: len(body), } fs = cgi.FieldStorage(fp=fp, environ=environ, headers=headers) return [fs, None] def lambda_handler(event, context): content_type = event[\u0026#39;headers\u0026#39;].get(\u0026#39;Content-Type\u0026#39;, \u0026#39;\u0026#39;) or event[\u0026#39;headers\u0026#39;].get(\u0026#39;content-type\u0026#39;, \u0026#39;\u0026#39;) if content_type == \u0026#39;application/json\u0026#39;: book_item = json.loads(event[\u0026#34;body\u0026#34;]) else: book_data, book_data_error = get_data_from_request_body( content_type=content_type, body=event[\u0026#34;body\u0026#34;] ) name = book_data[\u0026#39;image\u0026#39;].filename image = book_data[\u0026#39;image\u0026#39;].value s3.put_object(Bucket=\u0026#39;book-image-store\u0026#39;, Key=name, Body=image) image_path = \u0026#34;https://{}.s3.{}.amazonaws.com/{}\u0026#34;.format(\u0026#34;book-image-resize-store\u0026#34;, runtime_region, name) book_item = { \u0026#34;id\u0026#34;: book_data[\u0026#39;id\u0026#39;].value, \u0026#34;rv_id\u0026#34;: 0, \u0026#34;name\u0026#34;: book_data[\u0026#39;name\u0026#39;].value, \u0026#34;author\u0026#34;: book_data[\u0026#39;author\u0026#39;].value, \u0026#34;price\u0026#34; : book_data[\u0026#39;price\u0026#39;].value, \u0026#34;category\u0026#34;: book_data[\u0026#39;category\u0026#39;].value, \u0026#34;description\u0026#34;: book_data[\u0026#39;description\u0026#39;].value, \u0026#34;image\u0026#34;: image_path } table = client.Table(\u0026#39;Books\u0026#39;) table.put_item(Item = book_item) response = { \u0026#39;statusCode\u0026#39;: 200, \u0026#39;body\u0026#39;: \u0026#39;successfully created item!\u0026#39;, \u0026#39;headers\u0026#39;: { \u0026#39;Content-Type\u0026#39;: \u0026#39;application/json\u0026#39;, \u0026#34;Access-Control-Allow-Headers\u0026#34;: \u0026#34;Access-Control-Allow-Headers, Origin, Accept, X-Requested-With, Content-Type, Access-Control-Request-Method,X-Access-Token, XKey, Authorization\u0026#34;, \u0026#34;Access-Control-Allow-Origin\u0026#34;: \u0026#34;*\u0026#34;, \u0026#34;Access-Control-Allow-Methods\u0026#34;: \u0026#34;GET,PUT,POST,DELETE,OPTIONS\u0026#34; }, } return response Chạy dòng lệnh dưới đây triển khai SAM  sam build sam deploy --guided Trở lại với bảng điều khiển của Lambda   Ấn vào function book_create đã được tạo  Ấn sang tab Configuration   Chọn mục Permissions ở menu bên trái Ấn vào role mà function đang thực hiện.  Mở rộng policy, thấy các quyền đã được cấp cho function  Mở bảng điều khiển của Amazon S3, bucket book-image-store đã được tạo  "
},
{
	"uri": "/vi/4-config-api-gw/4-2-post-api/",
	"title": "Tạo POST API",
	"tags": [],
	"description": "",
	"content": " Mở tệp template.yaml trong thư mục fcj-book-store Thêm đoạn script sau vào cuối tệp tạo method POST   post: responses: \u0026#34;200\u0026#34;: description: 200 response headers: Access-Control-Allow-Origin: type: string x-amazon-apigateway-integration: uri: Fn::Sub: \u0026#34;arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${BookCreate.Arn}/invocations\u0026#34; responses: default: statusCode: 200 responseParameters: method.response.header.Access-Control-Allow-Origin: \u0026#34;\u0026#39;*\u0026#39;\u0026#34; passthroughBehavior: when_no_match httpMethod: POST #always POST type: aws_proxy  Thêm đoạn script sau vào cuối của function BookCreate   Events: CreateBook: Type: Api Properties: Path: /books/ Method: post RestApiId: Ref: BookApi Chạy dòng lệnh dưới đây triển khai SAM  sam build sam deploy --guided \rNhập \u0026ldquo;y\u0026rdquo; nếu được hỏi \u0026ldquo;BookCreate may not have authorization defined, Is this okay? [y/N]:\u0026rdquo;\n\rMở bảng điều khiển của function book_create   Ấn vào API Gateway  Hiện thị API Gateway đang được tương tác với function   Ấn vào API Gateway đó  Hiện thị các resource và method POST  Chọn tab Stages ở menu phía bên trái   Ấn chọn staging Ấn chọn POST Ghi lại InvokeURL của method POST  "
},
{
	"uri": "/vi/2-front-end-deployment/",
	"title": "Triển khai front-end",
	"tags": [],
	"description": "",
	"content": "Bước phần này, chúng ta sẽ tạo một S3 bucket với Static web hosting được kích hoạt và được truy cập công cộng dựa trên SAM:\n Mở tệp template.yaml trong thư mục fcj-book-store mà chúng ta vừa tạo ở phần 1.   Xoá phần không cần thiết:  Sao chép đoạn script sau vào tệp đó:  FcjBookStore:\rType: AWS::S3::Bucket\rProperties:\rAccessControl: PublicRead\rBucketName: fcj-book-store\rWebsiteConfiguration:\rIndexDocument: index.html\rFcjBookStorePolicy:\rType: AWS::S3::BucketPolicy\rProperties:\rBucket: !Ref FcjBookStore\rPolicyDocument:\rVersion: 2012-10-17\rStatement:\r- Action: - \u0026#39;s3:GetObject\u0026#39;\rEffect: Allow\rPrincipal: \u0026#39;*\u0026#39;\rResource: !Join\r- \u0026#39;\u0026#39;\r- - \u0026#39;arn:aws:s3:::\u0026#39;\r- !Ref FcjBookStore\r- /* Đoạn script định nghĩa một S3 bucket fcj-book-store với policy là FcjBookStorePolicy - cho phép truy cập công cộng\nChạy dòng lệnh dưới đây để build tại thư mục của SAM project: fcj-book-store  sam build  Chạy dòng lệnh sau để kiểm tra tính chính xác của SAM template  sam validate  Chạy dòng lệnh dưới để triển khai SAM  sam deploy --guided  Nhập tên cho stack: fcj-book-store Nhập vùng mà bạn muốn triển khai, ví dụ: ap-southeast-1 Sau đó nhập các thông tin khác như hình dưới đây:   Đợi một lúc để tạo CloudFormation stack changeset Nhập \u0026ldquo;y\u0026rdquo; khi được hỏi Deploy this changeset?  Mở bảng điều khiển của Amazon S3  Kiểm tra xem bucket đã được tạo hay chưa.   Ấn vào bucket fcj-book-store  Ấn sang tab Properties  Kéo xuống cuối trang, kiểm tra trạng thái của Static website hosting   Ghi lại endpoint của website   Ấn sang tab Permissions   Thấy policy đã được thêm  Mở bảng điều khiển của CloudFormation  Hai stack đã được tạo   Ấn vào stack fcj-book-store  Ấn sang tab Resource, thấy những resource mà CloudFormation đã khởi tạo   Ấn sang stack còn lại:  Tải code fcj-serverless-frontend về máy của bạn   Mở terminal trên máy bạn tại thư mục bạn muốn lưu source code Sao chép câu lệnh dưới đây  git clone https://github.com/PhamTHHanh/fcj-serverless-frontend.git\rcd fcj-serverless-frontend\ryarn build Chúng ta đã build xong front-end. Tiếp theo thực hiện câu lệnh sau để tải thư mục build lên S3  aws s3 cp build s3://fcj-book-store --recursive Kết quả sau khi tải xong:\n"
},
{
	"uri": "/vi/3-deploy-lambda-function/3-2-deploy-lambda-function/",
	"title": "Triển khai Lambda function",
	"tags": [],
	"description": "",
	"content": "Trong bước này chúng ta sẽ lần lượt tạo các Lambda function để đọc, ghi và xoá dữ liệu trong DynamoDB. Sau đó cấp các quyền cần thiết cho các function đó.\nNội dung  Lambda function ghi dữ liệu Tạo function lấy dữ liệu Tạo function xoá dữ liệu  "
},
{
	"uri": "/vi/3-deploy-lambda-function/3-2-deploy-lambda-function/3-2-3-delete-data-function/",
	"title": "Lambda function xoá dữ liệu",
	"tags": [],
	"description": "",
	"content": "Chúng ta sẽ tạo một Lambda function xoá toàn bộ item có partition key và sort key được chỉ định trong bảng của DynamoDB. Và xoá cả tệp ảnh trong S3 bucket:\n Mở tệp template.yaml trong thư mục fcj-book-store Thêm đoạn script sau vào cuối tệp để tạo Lambda function xoá dữ liệu của DynamoDB   BookDelete: Type: AWS::Serverless::Function Properties: CodeUri: fcj-book-store/book_delete Handler: book_delete.lambda_handler Runtime: python3.9 FunctionName: book_delete Architectures: - x86_64 Policies: - Statement: - Sid: VisualEditor0 Effect: Allow Action: - dynamodb:DeleteItem - dynamodb:GetItem - dynamodb:Query - s3:DeleteObject Resource: - !Sub arn:aws:dynamodb:${AWS::Region}:${AWS::AccountId}:table/Books - arn:aws:s3:::book-image-resize-store/*  Thêm đoạn script sau vào cuối tệp để tạo S3 bucket lưu tập ảnh sau khi thay đổi kích thước với thiết lập CORS rule và policy   BookImageResizeStore: Type: AWS::S3::Bucket Properties: AccessControl: PublicRead BucketName: book-image-resize-store CorsConfiguration: CorsRules: - AllowedHeaders: - \u0026#39;*\u0026#39; AllowedMethods: - GET - PUT - POST - DELETE AllowedOrigins: - \u0026#39;*\u0026#39; BookImageResizeStorePolicy: Type: AWS::S3::BucketPolicy Properties: Bucket: !Ref BookImageResizeStore PolicyDocument: Version: 2012-10-17 Statement: - Action: - \u0026#39;s3:GetObject\u0026#39; Effect: Allow Principal: \u0026#39;*\u0026#39; Resource: !Join - \u0026#39;\u0026#39; - - \u0026#39;arn:aws:s3:::\u0026#39; - !Ref BookImageResizeStore - /* Cấu trúc thư mục như sau:  fcj-book-store ├── fcj-book-store │ ├── books_list │ │ └── books_list.py │ ├── book_create │ │ └── book_create.py │ └── book_delete │ └── book_delete.py └── template.yaml  Tạo thư mục tên book_delete trong thư mục fcj-book-store/fcj-book-store/ Tạo file book_delete.py và sao chép đoạn code sau vào nó  import boto3 import json s3 = boto3.client(\u0026#39;s3\u0026#39;) client = boto3.resource(\u0026#39;dynamodb\u0026#39;) def get_image_name(image_path): str_image = image_path.split(\u0026#34;/\u0026#34;) for image_path_item in str_image: image_name = image_path_item return image_name; def lambda_handler(event, context): error = None status = 200 delete_id = event[\u0026#39;pathParameters\u0026#39;] delete_id[\u0026#39;rv_id\u0026#39;] = 0 table = client.Table(\u0026#34;Books\u0026#34;) image_path = \u0026#34;\u0026#34; try: data = table.get_item(Key = delete_id) image_path = data[\u0026#39;Item\u0026#39;][\u0026#39;image\u0026#39;] image_name = get_image_name(image_path) except Exception as e: error = e try: response = table.query( ProjectionExpression=\u0026#34;rv_id\u0026#34;, KeyConditionExpression=\u0026#34;id = :id\u0026#34;, ExpressionAttributeValues={\u0026#34;:id\u0026#34;: delete_id[\u0026#39;id\u0026#39;]}) for item in response[\u0026#39;Items\u0026#39;]: delete_id[\u0026#39;rv_id\u0026#39;] = item[\u0026#39;rv_id\u0026#39;] print(delete_id) table.delete_item(Key = delete_id) print(image_name) s3.delete_object(Bucket=\u0026#39;book-image-resize-store\u0026#39;, Key=image_name) except Exception as e: error = e if error is None: message = \u0026#39;successfully deleted item!\u0026#39; else: message = \u0026#39;delete item fail\u0026#39; status = 400 return { \u0026#39;statusCode\u0026#39;: status, \u0026#39;body\u0026#39;: message, \u0026#39;headers\u0026#39;: { \u0026#39;Content-Type\u0026#39;: \u0026#39;application/json\u0026#39;, \u0026#39;Access-Control-Allow-Origin\u0026#39;: \u0026#39;*\u0026#39; }, } Chạy dòng lệnh dưới đây triển khai SAM  sam build sam deploy --guided Trở lại với bảng điều khiển của Lambda   Ấn vào function book_delete đã được tạo  Ấn sang tab Configuration   Chọn Permissions ở menu phía bên trái Ấn vào role mà function đang thực hiện  Mở rộng policy, thấy các quyền đã được cấp cho function  Mở bảng điều khiển của Amazon S3, bucket book-image-resize-store đã được tạo   Ấn chọn bucket đó  Ấn sang tab Permissions, thấy policy đã thêm vào bucket  Kéo xuống dưới cuối trang, thấy Cross-origin resource sharing đã được thiết lập  "
},
{
	"uri": "/vi/4-config-api-gw/4-3-delete-api/",
	"title": "Tạo DELETE API",
	"tags": [],
	"description": "",
	"content": " Mở tệp template.yaml trong thư mục fcj-book-store Thêm đoạn script sau vào cuối tệp tạo một method DELETE   /books/{id}: delete: responses: \u0026#34;200\u0026#34;: description: 200 response headers: Access-Control-Allow-Origin: type: string x-amazon-apigateway-integration: uri: Fn::Sub: \u0026#34;arn:aws:apigateway:${AWS::Region}:lambda:path/2015-03-31/functions/${BookDelete.Arn}/invocations\u0026#34; responses: default: statusCode: 200 responseParameters: method.response.header.Access-Control-Allow-Origin: \u0026#34;\u0026#39;*\u0026#39;\u0026#34; passthroughBehavior: when_no_match httpMethod: POST #always POST type: aws_proxy  Thêm đoạn script sau vào cuối của function BookDelete   Events: DeleteBook: Type: Api Properties: Path: /books/{id} Method: delete RestApiId: Ref: BookApi Chạy dòng lệnh dưới đây triển khai SAM  sam build sam deploy --guided \rNhập \u0026ldquo;y\u0026rdquo; nếu được hỏi \u0026ldquo;BookDelete may not have authorization defined, Is this okay? [y/N]: \u0026quot;\n\rMở bảng điều khiển của function book_delete   Ấn vào API Gateway  Hiện thị API Gateway đang được tương tác với function   Ấn vào API Gateway đó  Hiện thị các resource và method DELETE  Chọn tab Stages ở menu phía bên trái   Ấn chọn staging Ấn chọn DELTE Ghi lại InvokeURL của method DELETE  Thêm đoạn script sau vào cuối tệp template.yaml để API hỗ trợ các tệp Binary Media Types   BinaryMediaTypes: - multipart~1form-data Chạy dòng lệnh dưới đây triển khai SAM  sam build sam deploy --guided Trở lại với bảng điều khiển của API   Chọn Settings ở menu phía bên trái Kéo xuống dưới, kiểm tra xem multipart/form-data đã được thêm hay chưa trong phần Binary Meida Types  "
},
{
	"uri": "/vi/3-deploy-lambda-function/",
	"title": "Triển khai Lambda function",
	"tags": [],
	"description": "",
	"content": "Trong phần này chúng ta sẽ ba Lambda function để ghi, đọc và xoá dữ liệu trong DynamoDB với ngôn ngữ Python dựa trên AWS SAM.\nNội dung  Tạo bảng trong DynamoDB Triển khai Lambda function  "
},
{
	"uri": "/vi/3-deploy-lambda-function/3-2-deploy-lambda-function/3-2-4-resize-image-function/",
	"title": "Lambda function chỉnh ảnh",
	"tags": [],
	"description": "",
	"content": "Trong bước này chúng ta tạo một Lambda function mới chỉnh kích thước ảnh sau khi người dùng tải lên.\n Mở tệp template.yaml trong thư mục fcj-book-store Thêm đoạn script sau vào cuối tệp để tạo một function chỉnh ảnh  ImageResizer: Type: AWS::Serverless::Function Properties: CodeUri: fcj-book-store/resize_image/function.zip PackageType: Zip Handler: index.handler Runtime: nodejs16.x FunctionName: resize_image Architectures: - x86_64 Policies: - Statement: - Sid: ResizeUploadImage Effect: Allow Action: - s3:GetObject - s3:PutObject - s3:DeleteObject Resource: - arn:aws:s3:::book-image-store/* - arn:aws:s3:::book-image-resize-store/* Events: ResizeImage: Type: S3 Properties: Bucket: !Ref BookImageStore Events: s3:ObjectCreated:* Environment: Variables: WIDTH: 200 HEIGHT: 280 DES_BUCKET: book-image-resize-store  Thêm đoạn script sau vào cuối tệp để cấp quyền cho S3 bucket books-image-store sử dụng function này  LambdaInvokePermission: Type: \u0026#34;AWS::Lambda::Permission\u0026#34; Properties: FunctionName: !GetAtt ImageResizer.Arn Action: \u0026#34;lambda:InvokeFunction\u0026#34; Principal: \u0026#34;s3.amazonaws.com\u0026#34; SourceAccount: !Sub ${AWS::AccountId} SourceArn: !GetAtt BookImageStore.Arn Cấu trúc thư mục như sau:  fcj-book-store ├── fcj-book-store │ ├── books_list │ │ └── books_list.py │ ├── book_create │ │ └── book_create.py │ ├── book_delete │ │ └── book_delete.py │ ├── resize_image │ └── function.zip └── template.yaml  Tạo thư mục tên resize_image trong thư mục fcj-book-store/fcj-book-store/ Tải tệp dưới đây và sao chép vào thư mục trên  \r\rSource code\r\r\rfunction.zip\r\r(8382 ko)\r\r\r\rChạy dòng lệnh dưới đây triển khai SAM  sam build sam deploy --guided Trở lại với bảng điều khiển của Lambda   Ấn vào function resize_image đã được tạo  Ấn sang tab Configuration   Chọn mục Trigger ở bên menu bên trái, xuất hiện S3 bucket book-image-store  Chọn mục Permissions ở menu bên trái   Ấn vào role mà function đang thực hiện.  Mở rộng policy, thấy các quyền đã được cấp cho function  "
},
{
	"uri": "/vi/4-config-api-gw/",
	"title": "Thiết lập API Gateway",
	"tags": [],
	"description": "",
	"content": "Tiếp theo, chúng ta sẽ thiết lập API Gateway tương tác với các Lambda function đã tạo ở phần trước trên SAM:\nNội dung  Tạo GET API Tạo POST API Tạo DELETE API  "
},
{
	"uri": "/vi/5-test-api-by-postman/",
	"title": "Kiểm tra API với Postman",
	"tags": [],
	"description": "",
	"content": "Trong bước này, chúng ta sẽ kiểm tra hoạt động của các API bằng công cụ Postman\nKiểm tra API đọc  Ấn vào dấu + để thêm 1 tab mới   Chọn GET method Nhập InvokURL của GET API đã ghi lại từ bước trước Ấn nút Send  Kết quả trả về là toàn bộ dữ liệu của bảng Books đã qua xử lý  Kiểm tra API ghi  Tương tự tạo một tab mới   Chọn POST method Nhập InvokURL của POST API đã ghi lại từ bước trước Trong mục Body, chọn raw Sao chép đoạn dưới đây:  { \u0026#34;id\u0026#34;: \u0026#34;5\u0026#34;, \u0026#34;rv_id\u0026#34;: 0, \u0026#34;name\u0026#34;: \u0026#34;Learning DevOps\u0026#34;, \u0026#34;author\u0026#34;: \u0026#34;Mikeal Krief\u0026#34;, \u0026#34;price\u0026#34;: \u0026#34;14.95\u0026#34;, \u0026#34;category\u0026#34;: \u0026#34;IT\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;The complete guide to accelerate collaboration with Jenkins, Kubernetes, Terraform and Azure DevOps\u0026#34;, \u0026#34;image\u0026#34;: \u0026#34;https://book-image-resize-store.s3.ap-southeast-1.amazonaws.com/LearningDevOps.jpeg\u0026#34; } Chuyển sang mục Headers   Thêm KEY là Content-Type, VALUE là application/json Ấn nút Send  Đợi một chút, xem kết quả trả về  Mở bảng Books trong bảng điều khiển của DynamoDB kiểm tra dữ liệu   Trước khi gọi API ghi   Sau khi gọi API ghi  Kiểm tra API xoá Vì Lambda function xoá khi thực hiện sẽ xoá ảnh được tải lên bởi người dùng, nên chúng ta tải thủ công ảnh lên S3 bucket để API có thể chạy đúng.\n Mở bảng điều khiển của Amazon S3 Ấn vào bucket book-image-store  Ấn nút Upload  Ấn nút Add files  Tải ảnh sau về máy của bạn và chọn nó để tải lên bucket  \r\r\rImage\r\r\rLearningDevOps.jpeg\r\r(24 ko)\r\r\r\r6. Ấn nút Upload\nSau khi tải xong, chuyển sang bucket book-image-resize-store kiểm tra. Đây là kết quả chạy của reszie_image Lambda funtion  Trở lại với Postman, thêm một tab mới để thực hiện API xoá   Chọn DELETE method Nhập InvokeURL của DELETE API đã ghi lại từ bước trước, thay /{id} bằng /5 Ấn nút Send  Kiểm tra kết quả trả về:  Mở bảng Books trong bảng điều khiển của DynamoDB kiểm tra dữ liệu  Mở bucket book-image-resize-store kiểm tra kết quả. Ảnh LearningDevOps.jpeg đã xoá.  "
},
{
	"uri": "/vi/6-test-front-end/",
	"title": "Kiểm tra API với front-end",
	"tags": [],
	"description": "",
	"content": "Sau khi kiểm tra các API hoạt động đúng với Postman, chúng ta sẽ kiểm tra các API được gọi với front-end xây dựng từ bước 2.\n Mở tệp config.js trong thư mục fcj-serverless-frontend đã được tải về từ phần 2   Thay giá trị cho APP_API_URL bằng URL của bạn:  Mở tệp App.js trong thư mục fcj-serverless-frontend/src/, sửa giá trị của biến isAdmin thành true Chạy các dòng lệnh dưới đây:  yarn build aws s3 cp build s3://fcj-book-store --recursive Dán endpoint của S3 static web vào browser của bạn. Ứng dụng đã hiện thông tin sách, nhưng vẫn chưa có ảnh vì chúng ta chưa tải ảnh lên.  Vậy API đọc dữ liệu đã hoạt động đúng.\nKiểm tra API ghi dữ liệu:   Ấn sang tab Management Ấn nút Update   Sửa bất kỳ thông tin gì bạn muốn trừ id Ấn nút Choose image Đưa ảnh dưới đây tải lên bucket: \r\rImage\r\r\rDockerInAction.jpeg\r\r(33 ko)\r\r\r\r Ấn nút Update   Ấn nút OK   Ảnh và thông tin được cập nhật   Ấn sang tab Create new book ghi dữ liệu mới vào cơ sở dữ liệu Nhập id bằng 5 Nhập tên: Learning DevOps Nhập tác giả: Mikeal Krief Nhập thể loại: IT Nhập giá: 14.95 Nhập mô tả: The complete guide to accelerate collaboration with Jenkins, Kubernetes, Terraform and Azure DevOps Ấn nút Choose File để tải ảnh lên Ấn nút Create   Ấn nút OK   Hiển thị thông tin vừa tạo  Kiểm tra API xoá   Ấn sang tab Management Ấn nút Update   Ấn nút Delete   Ấn nút OK để xác nhận xoá   Ấn nút OK   Xem kết quả sau khi xoá: không còn xuất hiện thông tin sách nữa  Chúng ta đã hoàn thành việc xây dựng một ứng dụng web đơn giản theo mô hình serverless. Để xây dựng ứng dụng serverless nhanh hơn, trong phần tiếp theo chúng ta sẽ sử dụng AWS Serverless Application Model (SAM). SAM cung cấp cú pháp để diễn đạt các hàm, API, cơ sở dữ liệu và event source mappings.\n"
},
{
	"uri": "/vi/7-cleanup/",
	"title": "Dọn dẹp tài nguyên",
	"tags": [],
	"description": "",
	"content": " Làm rỗng S3 bucket   Mở bảng điều khiển của AWS S3 Chọn fcj-book-store Ấn Empty Nhập permanently delete Ấn Empty Làm tương tự với bucket bắt đầu bằng aws-sam-cli-managed-default-  Xoá stack của CloudFormation   Chạy câu lệnh dưới đây để xoá ứng dụng AWS SAM  sam delete --stack-name fcj-book-store sam delete --stack-name aws-sam-cli-managed-default "
},
{
	"uri": "/vi/categories/",
	"title": "Categories",
	"tags": [],
	"description": "",
	"content": ""
},
{
	"uri": "/vi/tags/",
	"title": "Tags",
	"tags": [],
	"description": "",
	"content": ""
}]